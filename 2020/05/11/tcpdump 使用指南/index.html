<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>tcpdump 使用指南 | 远辰</title><meta name="keywords" content="Golang"><meta name="author" content="哪吒藕霸"><meta name="copyright" content="哪吒藕霸"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="tcpdump 使用指南"><meta name="application-name" content="tcpdump 使用指南"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="tcpdump 使用指南"><meta property="og:url" content="https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.html"><meta property="og:site_name" content="远辰"><meta property="og:description" content="深入理解Golang的反射"><meta property="og:locale" content="zh"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="哪吒藕霸"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="深入理解Golang的反射"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 哪吒藕霸","link":"链接: ","source":"来源: 远辰","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '远辰',
  title: 'tcpdump 使用指南',
  postAI: '',
  pageFillDescription: '2.1 输出内容结构, 2.2 Flags 标识符, 3.1 基于 IP 地址过滤：host, 3.2 基于网段进行过滤：net, 3.3 基于端口进行过滤：port, 3.4 基于协议进行过滤：proto, 3.5 基本 IP 协议的版本进行过滤, 4.1 设置不解析域名提升速度, 4.2 过滤结果输出到文件, 4.3 从文件中读取包数据, 4.4 控制详细内容的输出, 4.5 控制时间的显示, 4.6 显示数据包的头部, 4.7 过滤指定网卡的数据包, 4.8 过滤特定流向的数据包, 4.9 其他常用的一些参数, 4.10 对输出内容进行控制的参数, 5.1 根据 tcpflags 进行过滤, 5.2 基于包大小进行过滤, 5.3 根据 mac 地址进行过滤, 5.4 过滤通过指定网关的数据包, 5.5 过滤广播 x2F 多播数据包, 8.1 提取 HTTP 的 User-Agent, 8.2 抓取 HTTP GET 和 POST 请求, 8.3 找出发包数最多的 IP, 8.4 抓取 DNS 请求和响应, 8.5 切割 pcap 文件, 8.6 提取 HTTP POST 请求中的密码, 8.7 提取 HTTP 请求的 URL, 8.8 抓取 HTTP 有效数据包, 8.9 结合 Wireshark 进行分析在讲解之前有两点需要声明第三节到第六节里的命令示例只为了说明参数的使用并不一定就能抓到包如果要精准抓到你所需要的包需要配合第五节的逻辑逻辑运算符进行组合搭配不同发行版下不同版本的可能有小许差异本文是基于的版本的进行学习的若在你的环境中无法使用请参考进行针对性学习核心参数图解大家都知道网络上的流量数据包非常的多因此要想抓到我们所需要的数据包就需要我们定义一个精准的过滤器把这些目标数据包从巨大的数据包网络中抓取出来所以学习抓包工具其实就是学习如何定义过滤器的过程而在的世界里过滤器的实现都是通过一个又一个的参数组合起来一个参数不够精准那就再加一个直到我们能过滤掉无用的数据包只留下我们感兴趣的数据包的参数非常的多初学者在没有掌握时会对这个命令的众多参数产生很多的疑惑就比如下面这个命令我们要通过参数指定进行过滤主程序参数名参数值这样的组合才是我们正常认知里面命令行该有的样子可却不走寻常路我们居然还可以在前再加一个限定词来缩小过滤的范围从字面上理解确实很容易理解但是这不符合编写命令行程序的正常逻辑导致我们会有所疑虑除了可还有其它可以用的限定词应该如何理解它们叫参数名不合适因为明显不合适如果你在网上看到有关的博客教程无一不是给你一个参数组合告诉你这是实现了怎样的一个过滤器这样的教学方式很容易让你依赖别人的文章来使用而不能将这样神器消化达到灵活应用灵活搭配过滤器的效果上面加了本身就颠覆了我们的认知你可知道在之前还可以加更多的条件比如等词在你之前的基础上再过滤一层这种参数的不确定性让大多数人对的学习始终无法得其精髓因此在学习之前我觉得有必要要先让你知道的参数是如何组成的这非常重要为此我画了一张图方便你直观的理解的各种参数可选参数将在后边一一解释类过滤器根据协议进行过滤可识别的关键词有类过滤器可识别的关键词有这些词后边需要再接参数类过滤器根据数据流向进行过滤可识别的关键字有同时你可以使用逻辑运算符进行组合比如这三类过滤器的内容比较简单也最常用因此我将其放在最前面也就是第三节常规过滤规则一起介绍而可选的参数非常多有的甚至也不经常用到因此我将其放到后面一点也就是第四节可选参数解析当你看完前面六节你对的认识会上了一个台阶至少能够满足你的使用需求你一定会问了还有呢其实还有一些过滤关键词它不符合以上四种过滤规则可能需要你单独记忆关于这部分我会在第六节特殊过滤规则里进行介绍理解的输出输出内容结构输出的内容虽然多却很规律这里以我随便抓取的一个包为例来看一下从上面的输出来看可以总结出第一列时分秒毫秒第二列网络协议第三列发送方的地址端口号其中是而是端口号第四列箭头表示数据流向第五列接收方的地址端口号其中是而是端口号第六列冒号第七列数据包内容包括标识符号号窗口数据长度其中表示标志位为更多标识符见下面标识符使用抓包后会遇到的报文有以下几种开始连接推送数据结束连接重置连接没有意思是除上面四种类型外的其他情况有可能是也有可能是常规过滤规则基于地址过滤使用就可以指定进行过滤数据包的可以再细分为源和目标两种根据源进行过滤根据目标进行过滤基于网段进行过滤若你的范围是一个网段可以直接这样指定网段同样可以再细分为源网段和目标网段根据源网段进行过滤根据目标网段进行过滤基于端口进行过滤使用就可以指定特定端口进行过滤端口同样可以再细分为源端口目标端口根据源端口进行过滤根据目标端口进行过滤如果你想要同时指定两个端口你可以这样写但也可以简写成这样如果你的想抓取的不再是一两个端口而是一个范围一个一个指定就非常麻烦了此时你可以这样指定一个端口段对于一些常见协议的默认端口我们还可以直接使用协议名而不用具体的端口号比如等基于协议进行过滤常见的网络协议有等若你只想查看的包可以直接这样写可选值基本协议的版本进行过滤当你想查看的包你也许会这样子写这样子写也没问题就是不够精准为什么这么说呢根据版本的不同可以再细分为和两种如果你只指定了这两种其实都会包含在内那有什么办法能够将和区分开来呢很简单如果是的包就这样写友情提示数字表示的是在报文中的编号而如果是的包就这样写关于上面这几个命令示例有两点需要注意跟在和后面的如果是那么过滤器需要用引号包含这是因为是的关键字跟在和关键字后面的和是两个新面孔看起来用法类似它们是否等价又有什么区别呢关于第二点网络上没有找到很具体的答案我只能通过的提示给出自己的个人猜测但不保证正确后面跟的的关键词是固定的只能是这里面的其中一个而后面跟的要求就没有那么严格它可以是任意词只要的报文头部里的字段为就能匹配上理论上来讲下面两种写法效果是一样的同样的这两种写法也是一样的可选参数解析设置不解析域名提升速度不把转化成域名直接显示避免执行的过程速度会快很多不把协议和端口号转化成名字速度也会快很多不打印出的域名部分比如如果设置了此选现将会打印而不是过滤结果输出到文件使用工具抓到包后往往需要再借助其他的工具进行分析比如常见的而要使用我们得将抓到的包数据生成到文件中最后再使用打开它即可使用参数后接一个以后缀命令的文件名就可以将抓到的数据保存到文件中从文件中读取包数据使用是写入数据到文件而使用是从文件中读取数据读取后我们照样可以使用上述的过滤器语法进行过滤分析控制详细内容的输出产生详细的输出比如包的标识数据包长度以及包的一些选项同时它还会打开一些附加的包完整性检测比如对或包头部的校验和产生比更详细的输出比如回应包中的附加域将会被打印数据包也会被完全解码摘自网络目前我还未使用过产生比更详细的输出比如时所使用的选项将会被打印如果同时使用的是图形界面其相应的图形选项将会以进制的方式打印出来摘自网络目前我还未使用过控制时间的显示在每行的输出中不输出时间在每行的输出中会输出时间戳输出每两行打印的时间间隔以毫秒为单位在每行打印的时间戳之前添加日期的打印此种选项输出的时间最直观显示数据包的头部以进制的形式打印每个包的头部数据但不包括数据链路层的头部以进制的形式打印每个包的头部数据包括数据链路层的头部以进制和码形式打印出每个包的数据但不包括连接层的头部这在分析一些新协议的数据包很方便以进制和码形式打印出每个包的数据包括连接层的头部这在分析一些新协议的数据包很方便过滤指定网卡的数据包指定要过滤的网卡接口如果要查看所有网卡可以过滤特定流向的数据包选择是入方向还是出方向的数据包可选项有也可以使用这种写法其他常用的一些参数以码方式显示每一个数据包不显示链路层头部信息在抓取包含网页数据的数据包时可方便查看数据基于行的输出便于你保存查看或者交给其它工具分析简洁地打印输出即打印很少的协议相关信息从而输出行都比较简短捕获个包就退出默认只会截取前字节的内容要想截取所有的报文内容可以使用就是你要截取的报文字节数如果是的话表示截取报文全部内容使用绝对序列号而不是相对序列号在把原始数据包直接保存到文件中之前检查此文件大小是否超过如果超过了将关闭此文件另创一个文件继续用于原始数据包的记录新创建的文件名与选项指定的文件名一致但文件名后多了一个数字该数字会从开始随着新创建文件的增多而增加的单位是百万字节这里指个字节并非个字节后者是以字节为字节为计算所得即使用文件作为过滤条件表达式的输入此时命令行上的输入将被忽略对输出内容进行控制的参数显示所有可用网络接口的列表每行的打印输出中将包括数据包的数据链路层头部信息揭秘数据列出指定网络接口所支持的数据链路层的类型后退出后接用户名在抓包时会受到权限的限制如果以用户启动将会有超级用户权限打印出易读的包匹配码以语言的形式打印出包匹配码以十进制数的形式打印出包匹配码过滤规则组合有编程基础的同学对于下面三个逻辑运算符应该不陌生了吧所有的条件都需要满足也可以表示为只要有一个条件满足就可以也可以表示为取反也可以使用举个例子我想需要抓一个来自发往任意主机的端口的包当你在使用多个过滤器进行组合时有可能需要用到括号而括号在中是特殊符号因为你需要使用引号将其包含例子如下而在单个过滤器里常常会判断一条件是否成立这时候就要使用下面两个符号判断二者相等判断二者相等判断二者不相等当你使用这两个符号时还提供了一些关键字的接口来方便我们进行判断比如表示网卡接口名表示进程名表示进程表示表示方向和表示表示比如我现在要过滤来自进程名为发出的流经网卡的数据包或者不流经的入方向数据包可以这样子写特殊过滤规则根据进行过滤通过上一篇文章我们知道了的首部有一个标志位支持我们根据数据包的标志位进行过滤可以是熟知的协议之一如可以是数值也可以是一个表达式表示与指定的协议头开始处的字节偏移量是可选的表示从字节偏移量开始取的字节数量接下来我将举几个例子让人明白它的写法不过在那之前有几个点需要你明白这在后面的例子中会用到可以理解为是一个别名常量相当于它代表着与指定的协议头开头相关的字节偏移量也就是标志位所以等价于对应下图中的报文位置这些同样可以理解为别名常量分别代表这些数字是如何计算出来的呢以为例你可以参照下面这张图计算出来的值是就是由于数字不好记忆所以一般使用这样的别名常量表示因此当下面这个表达式成立时就代表这个包是一个包要抓取特定数据包方法有很多种下面以最常见的包为例演示一下如何用抓取到包而其他的类型的包也是同样的道理据我总结主要有三种写法第一种写法使用数字表示偏移量第二种写法使用别名常量表示偏移量第三种写法使用混合写法如果我想同时捕获多种类型的包呢比如包第一种写法第二种写法第三种写法第四种写法注意这里是单个等号而不是像上面一样两个等号中有类似的别名常量其他协议也是有的比如协议可以使用的别名常量有基于包大小进行过滤若你想查看指定大小的数据包也是可以的根据地址进行过滤例子如下其中是记录在里的过滤通过指定网关的数据包过滤广播多播数据包如何抓取到更精准的包先给你抛出一个问题如果我只想抓取的请求该如何写呢如果只学习了上面的内容恐怕你还是无法写法满足这个抓取需求的过滤器在学习之前我先给出答案然后再剖析一下这个过滤器是如何生效的居然能让我们对包内的内容进行判断命令里的可选参数在前面的内容里已经详细讲过了这里不再细讲本节的重点是引号里的内容看起来很复杂的样子将它逐一分解我们只要先理解了下面几种用法就能明白表示报文里第个字节表示报文里从第个字节开始取个字节表示从报文的第个字节因为有第个字节所以这里的其实表示的是开始算起取一个字节也就是个查看的报文首部结构可以得知这个其实就是下图中的红框圈起来的位置而在这里我们只要前面个也就是实际数据在整个报文首部中的偏移量是位运算里的操作符比如是位运算里的右移操作比如是进制的的进制表示但对于位操作来说进制和进制都将毫无意义我们需要的是二进制将其转换成二进制后是这个数有什么特点呢前面个全部是后面个全部是往后看你就知道这个特点有什么用了分解完后再慢慢合并起来看其实并不直观但是我们将它换一种写法就好看多了假设报文中的第个字节是这样组成的那么这个表达式就可以变成得到了后再进入下一步如果你不理解报文首部里的数据偏移请先点击这个前往我的上一篇文章搞懂数据偏移的意义否则我保证你这里会绝对会听懵了这个表达式实际是的简写形式所以要搞懂只要理解了就行了从上一步我们算出了的值其实是一个字节也就是个但是你再回去看下上面的报文首部结构图表示数据偏移量的只有个也就是说上面得到的值前面位才是正确的偏移量那么为了得到只需要将右移位即可也就是至此我们是不是已经得出了实际数据的正确位置呢很遗憾还没有前一篇文章里我们讲到的单位是个字节因为要将乘以才可以除以在位运算中相当于左移位也就是与前面的结合起来一起算的话最终的运算可以简化为至此我们终于得出了实际数据开始的位置是单位是字节找到了数据的起点后可别忘了我们的目的是从数据中打到请求的方法是呢还是或者是其他的有了上面的经验我们自然懂得使用从数据开始的位置再取出四个字节然后将结果与注意最后还有个空格的进制写法也就是进行比对空格如果相等则该表达式为认为这就是我们所需要抓的数据包将其输出到我们的终端屏幕上抓包实战应用例子提取的从请求头中提取的通过可以同时提取和主机名或其他头文件抓取和请求抓取请求包可以抓取请求包注意该方法不能保证抓取到有效数据流量因为一个请求会被分割为多个数据包找出发包数最多的找出一段时间内发包最多的或者从一堆报文中找出发包最多的可以使用下面的命令以为分隔符打印出每行的前四列即地址排序并计数按照数值大小逆向排序抓取请求和响应的默认端口是因此可以通过端口进行过滤切割文件当抓取大量数据并写入文件时可以自动切割为多个大小相同的文件例如下面的命令表示每秒创建一个新文件每个文件大小不超过字节这些文件的命名为小时之后之前的文件就会被覆盖提取请求中的密码从请求中提取密码和主机名提取请求的提取请求的主机名和路径抓取有效数据包抓取端口的有效数据包排除连接建立过程的数据包结合进行分析通常或比更容易分析应用层协议一般的做法是在远程服务器上先使用抓取数据并写入文件然后再将文件拷贝到本地工作站上用分析还有一种更高效的方法可以通过连接将抓取到的数据实时发送给进行分析以系统为例可以通过来安装然后通过下面的命令来分析例如如果想分析协议可以使用下面的命令抓取到的数据选项用来限制抓取数据的大小如果不限制大小就只能通过来停止抓取这样一来不仅关闭了也关闭了到这里我已经将我所知道的的用法全部说了一遍如果你有认真地看完本文相信会有不小的收获掌握一个上手的抓包工具对于以后我们学习网络分析网络协议以及定位网络问题会很有帮助而是我推荐的一个抓包工具参考文章命令详解一份快速实用的命令参考手册超详细的网络抓包神器使用指南译示例教程英示例教程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-29 15:04:15',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">远辰</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DPDK/" style="font-size: 1.05rem;">DPDK<sup>3</sup></a><a href="/tags/ONOS/" style="font-size: 1.05rem;">ONOS<sup>1</sup></a><a href="/tags/algorithm/" style="font-size: 1.05rem;">algorithm<sup>1</sup></a><a href="/tags/blockchain/" style="font-size: 1.05rem;">blockchain<sup>1</sup></a><a href="/tags/c/" style="font-size: 1.05rem;">c<sup>1</sup></a><a href="/tags/configuration/" style="font-size: 1.05rem;">configuration<sup>1</sup></a><a href="/tags/container/" style="font-size: 1.05rem;">container<sup>25</sup></a><a href="/tags/go/" style="font-size: 1.05rem;">go<sup>14</sup></a><a href="/tags/kidgets/" style="font-size: 1.05rem;">kidgets<sup>3</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>40</sup></a><a href="/tags/network/" style="font-size: 1.05rem;">network<sup>8</sup></a><a href="/tags/rust/" style="font-size: 1.05rem;">rust<sup>6</sup></a><a href="/tags/sdn/" style="font-size: 1.05rem;">sdn<sup>4</sup></a><a href="/tags/systemtap/" style="font-size: 1.05rem;">systemtap<sup>4</sup></a><a href="/tags/tools/" style="font-size: 1.05rem;">tools<sup>1</sup></a><a href="/tags/tvbox/" style="font-size: 1.05rem;">tvbox<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">December 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">July 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">June 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>linux</span></a><a class="article-meta__tags" href="/tags/network/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>network</span></a></span></div></div><h1 class="post-title" itemprop="name headline">tcpdump 使用指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2020-05-11T11:44:56.000Z" title="发表于 2020-05-11 19:44:56">2020-05-11</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-05-29T07:04:15.081Z" title="更新于 2024-05-29 15:04:15">2024-05-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"><header><a href="/tags/linux/" tabindex="-1" itemprop="url">linux</a><a href="/tags/network/" tabindex="-1" itemprop="url">network</a><h1 id="CrawlerTitle" itemprop="name headline">tcpdump 使用指南</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">哪吒藕霸</span><time itemprop="dateCreated datePublished" datetime="2020-05-11T11:44:56.000Z" title="发表于 2020-05-11 19:44:56">2020-05-11</time><time itemprop="dateCreated datePublished" datetime="2024-05-29T07:04:15.081Z" title="更新于 2024-05-29 15:04:15">2024-05-29</time></header><p>在讲解之前，有两点需要声明：</p>
<ol>
<li><p>第三节到第六节里的 tcpdump 命令示例，只为了说明参数的使用，并不一定就能抓到包，如果要精准抓到你所需要的包，需要配合第五节的逻辑逻辑运算符进行组合搭配。</p>
</li>
<li><p>不同 Linux 发行版下、不同版本的 tcpdump 可能有小许差异， 本文是基于 CentOS 7.2 的 4.5.1 版本的 tcpdump 进行学习的，若在你的环境中无法使用，请参考 <code>man tcpdump</code> 进行针对性学习。</p>
</li>
<li><p>tcpdump 核心参数图解<a href="#idx_0">#</a></p>
</li>
</ol>
<hr>
<p>大家都知道，网络上的流量、数据包，非常的多，因此要想抓到我们所需要的数据包，就需要我们定义一个精准的过滤器，把这些目标数据包，从巨大的数据包网络中抓取出来。</p>
<p>所以学习抓包工具，其实就是学习如何定义过滤器的过程。</p>
<p>而在 tcpdump 的世界里，过滤器的实现，都是通过一个又一个的参数组合起来，一个参数不够精准，那就再加一个，直到我们能过滤掉无用的数据包，只留下我们感兴趣的数据包。</p>
<p>tcpdump 的参数非常的多，初学者在没有掌握 tcpdump 时，会对这个命令的众多参数产生很多的疑惑。</p>
<p>就比如下面这个命令，我们要通过 <code>host</code> 参数指定 host ip 进行过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump host 192.168.10.100</span><br></pre></td></tr></table></figure>

<p><code>主程序</code> + <code>参数名</code>+ <code>参数值</code> 这样的组合才是我们正常认知里面命令行该有的样子。</p>
<p>可 tcpdump 却不走寻常路，我们居然还可以在 host 前再加一个限定词，来缩小过滤的范围？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src host 192.168.10.100</span><br></pre></td></tr></table></figure>

<p>从字面上理解，确实很容易理解，但是这不符合编写命令行程序的正常逻辑，导致我们会有所疑虑：</p>
<ol>
<li><p>除了 src ，dst，可还有其它可以用的限定词？</p>
</li>
<li><p>src，host 应该如何理解它们，叫参数名？不合适，因为 src 明显不合适。</p>
</li>
</ol>
<p>如果你在网上看到有关 tcpdump 的博客、教程，无一不是给你一个参数组合，告诉你这是实现了怎样的一个过滤器？这样的教学方式，很容易让你依赖别人的文章来使用 tcpdump，而不能将 tcpdump 这样神器消化，达到灵活应用，灵活搭配过滤器的效果。</p>
<p>上面加了 src 本身就颠覆了我们的认知，你可知道在 src 之前还可以加更多的条件，比如 tcp, udp, icmp 等词，在你之前的基础上再过滤一层。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump tcp src host 192.168.10.100</span><br></pre></td></tr></table></figure>

<p>这种参数的不确定性，让大多数人对 tcpdump 的学习始终无法得其精髓。</p>
<p>因此，在学习 tcpdump 之前，我觉得有必要要先让你知道：<strong>tcpdump 的参数是如何组成的？这非常重要。</strong></p>
<p>为此，我画了一张图，方便你直观的理解 tcpdump 的各种参数：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://image.iswbm.com/20200628111325.png"></p>
<ol>
<li>option 可选参数：将在后边一一解释。</li>
<li>proto 类过滤器：根据协议进行过滤，可识别的关键词有： tcp, udp, icmp, ip, ip6, arp, rarp,ether,wlan, fddi, tr, decnet</li>
<li>type 类过滤器：可识别的关键词有：host, net, port, portrange，这些词后边需要再接参数。</li>
<li>direction 类过滤器：根据数据流向进行过滤，可识别的关键字有：src, dst，同时你可以使用逻辑运算符进行组合，比如 src or dst</li>
</ol>
<p>proto、type、direction 这三类过滤器的内容比较简单，也最常用，因此我将其放在最前面，也就是 <strong>第三节：常规过滤规则</strong>一起介绍。</p>
<p>而 option 可选的参数非常多，有的甚至也不经常用到，因此我将其放到后面一点，也就是 <strong>第四节：可选参数解析</strong></p>
<p>当你看完前面六节，你对 tcpdump 的认识会上了一个台阶，至少能够满足你 80% 的使用需求。</p>
<p>你一定会问了，还有 20% 呢？</p>
<p>其实 tcpdump 还有一些过滤关键词，它不符合以上四种过滤规则，可能需要你单独记忆。关于这部分我会在 <strong>第六节：特殊过滤规则</strong> 里进行介绍。</p>
<ol start="2">
<li>理解 tcpdump 的输出<a href="#idx_1">#</a></li>
</ol>
<hr>
<h3 id="2-1-输出内容结构"><a href="#2-1-输出内容结构" class="headerlink" title="2.1 输出内容结构#"></a>2.1 输出内容结构<a href="#idx_2">#</a></h3><p>tcpdump 输出的内容虽然多，却很规律。</p>
<p>这里以我随便抓取的一个 tcp 包为例来看一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21:26:49.013621 IP 172.20.20.1.15605 &gt; 172.20.20.2.5920: Flags [P.], seq 49:97, ack 106048, win 4723, length 48</span><br></pre></td></tr></table></figure>

<p>从上面的输出来看，可以总结出：</p>
<ol>
<li>第一列：时分秒毫秒 21:26:49.013621</li>
<li>第二列：网络协议 IP</li>
<li>第三列：发送方的 ip 地址 + 端口号，其中 172.20.20.1 是 ip，而 15605 是端口号</li>
<li>第四列：箭头 &gt;， 表示数据流向</li>
<li>第五列：接收方的 ip 地址 + 端口号，其中 172.20.20.2 是 ip，而 5920 是端口号</li>
<li>第六列：冒号</li>
<li>第七列：数据包内容，包括 Flags 标识符，seq 号，ack 号，win 窗口，数据长度 length，其中 [P.] 表示 PUSH 标志位为 1，更多标识符见下面</li>
</ol>
<h3 id="2-2-Flags-标识符"><a href="#2-2-Flags-标识符" class="headerlink" title="2.2 Flags 标识符#"></a>2.2 Flags 标识符<a href="#idx_3">#</a></h3><p>使用 tcpdump 抓包后，会遇到的 TCP 报文 Flags，有以下几种：</p>
<ul>
<li><code>[S]</code> : SYN（开始连接）</li>
<li><code>[P]</code> : PSH（推送数据）</li>
<li><code>[F]</code> : FIN （结束连接）</li>
<li><code>[R]</code> : RST（重置连接）</li>
<li><code>[.]</code> : 没有 Flag （意思是除上面四种类型外的其他情况，有可能是 ACK 也有可能是 URG）</li>
</ul>
<ol start="3">
<li>常规过滤规则<a href="#idx_4">#</a></li>
</ol>
<hr>
<h3 id="3-1-基于-IP-地址过滤：host"><a href="#3-1-基于-IP-地址过滤：host" class="headerlink" title="3.1 基于 IP 地址过滤：host#"></a>3.1 基于 IP 地址过滤：host<a href="#idx_5">#</a></h3><p>使用 <code>host</code> 就可以指定 host ip 进行过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump host 192.168.10.100</span><br></pre></td></tr></table></figure>

<p>数据包的 ip 可以再细分为源 ip 和目标 ip 两种</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 根据源ip进行过滤</span><br><span class="line">$ tcpdump -i eth2 src 192.168.10.100</span><br><span class="line"></span><br><span class="line"># 根据目标ip进行过滤</span><br><span class="line">$ tcpdump -i eth2 dst 192.168.10.200</span><br></pre></td></tr></table></figure>

<h3 id="3-2-基于网段进行过滤：net"><a href="#3-2-基于网段进行过滤：net" class="headerlink" title="3.2 基于网段进行过滤：net#"></a>3.2 基于网段进行过滤：net<a href="#idx_6">#</a></h3><p>若你的 ip 范围是一个网段，可以直接这样指定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump net 192.168.10.0/24</span><br></pre></td></tr></table></figure>

<p>网段同样可以再细分为源网段和目标网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 根据源网段进行过滤</span><br><span class="line">$ tcpdump src net 192.168</span><br><span class="line"></span><br><span class="line"># 根据目标网段进行过滤</span><br><span class="line">$ tcpdump dst net 192.168</span><br></pre></td></tr></table></figure>

<h3 id="3-3-基于端口进行过滤：port"><a href="#3-3-基于端口进行过滤：port" class="headerlink" title="3.3 基于端口进行过滤：port#"></a>3.3 基于端口进行过滤：port<a href="#idx_7">#</a></h3><p>使用 <code>port</code> 就可以指定特定端口进行过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port 8088</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>端口同样可以再细分为源端口，目标端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 根据源端口进行过滤</span><br><span class="line">$ tcpdump src port 8088</span><br><span class="line"></span><br><span class="line"># 根据目标端口进行过滤</span><br><span class="line">$ tcpdump dst port 8088</span><br></pre></td></tr></table></figure>

<p>如果你想要同时指定两个端口你可以这样写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port 80 or port 8088</span><br></pre></td></tr></table></figure>

<p>但也可以简写成这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port 80 or 8088</span><br></pre></td></tr></table></figure>

<p>如果你的想抓取的不再是一两个端口，而是一个范围，一个一个指定就非常麻烦了，此时你可以这样指定一个端口段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump portrange 8000-8080</span><br><span class="line">$ tcpdump src portrange 8000-8080</span><br><span class="line">$ tcpdump dst portrange 8000-8080</span><br></pre></td></tr></table></figure>

<p>对于一些常见协议的默认端口，我们还可以直接使用协议名，而不用具体的端口号</p>
<p>比如 http &#x3D;&#x3D; 80，https &#x3D;&#x3D; 443 等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump tcp port http</span><br></pre></td></tr></table></figure>

<h3 id="3-4-基于协议进行过滤：proto"><a href="#3-4-基于协议进行过滤：proto" class="headerlink" title="3.4 基于协议进行过滤：proto#"></a>3.4 基于协议进行过滤：proto<a href="#idx_8">#</a></h3><p>常见的网络协议有：tcp, udp, icmp, http, ip,ipv6 等</p>
<p>若你只想查看 icmp 的包，可以直接这样写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump icmp</span><br></pre></td></tr></table></figure>

<p>protocol 可选值：ip, ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl, moprc, iso, stp, ipx, or netbeui</p>
<h3 id="3-5-基本-IP-协议的版本进行过滤"><a href="#3-5-基本-IP-协议的版本进行过滤" class="headerlink" title="3.5 基本 IP 协议的版本进行过滤#"></a>3.5 基本 IP 协议的版本进行过滤<a href="#idx_9">#</a></h3><p>当你想查看 tcp 的包，你也许会这样子写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump tcp</span><br></pre></td></tr></table></figure>

<p>这样子写也没问题，就是不够精准，为什么这么说呢？</p>
<p>ip 根据版本的不同，可以再细分为 IPv4 和 IPv6 两种，如果你只指定了 tcp，这两种其实都会包含在内。</p>
<p>那有什么办法，能够将 IPv4 和 IPv6 区分开来呢？</p>
<p>很简单，如果是 IPv4 的 tcp 包 ，就这样写（友情提示：数字 6 表示的是 tcp 在 ip 报文中的编号。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &#x27;ip proto tcp&#x27;</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump ip proto 6</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump &#x27;ip protochain tcp&#x27;</span><br><span class="line"></span><br><span class="line"># or </span><br><span class="line"></span><br><span class="line">$ tcpdump ip protochain 6</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而如果是 IPv6 的 tcp 包 ，就这样写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &#x27;ip6 proto tcp&#x27;</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump ip6 proto 6</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump &#x27;ip6 protochain tcp&#x27;</span><br><span class="line"></span><br><span class="line"># or </span><br><span class="line"></span><br><span class="line">$ tcpdump ip6 protochain 6</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关于上面这几个命令示例，有两点需要注意：</p>
<ol>
<li>跟在 proto 和 protochain 后面的如果是 tcp, udp, icmp ，那么过滤器需要用引号包含，这是因为 tcp,udp, icmp 是 tcpdump 的关键字。</li>
<li>跟在 ip 和 ip6 关键字后面的 proto 和 protochain 是两个新面孔，看起来用法类似，它们是否等价，又有什么区别呢？</li>
</ol>
<p>关于第二点，网络上没有找到很具体的答案，我只能通过 <code>man tcpdump</code> 的提示， 给出自己的个人猜测，但不保证正确。</p>
<p>proto 后面跟的 <code>&lt;protocol&gt;</code> 的关键词是固定的，只能是 ip, ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl, moprc, iso, stp, ipx, or netbeui 这里面的其中一个。</p>
<p>而 protochain 后面跟的 protocol 要求就没有那么严格，它可以是任意词，只要 tcpdump 的 IP 报文头部里的 protocol 字段为 <code>&lt;protocol&gt;</code> 就能匹配上。</p>
<p>理论上来讲，下面两种写法效果是一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &#x27;ip &amp;&amp; tcp&#x27;</span><br><span class="line">$ tcpdump &#x27;ip proto tcp&#x27;</span><br></pre></td></tr></table></figure>

<p>同样的，这两种写法也是一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &#x27;ip6 &amp;&amp; tcp&#x27;</span><br><span class="line">$ tcpdump &#x27;ip6 proto tcp&#x27;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>可选参数解析<a href="#idx_10">#</a></li>
</ol>
<hr>
<h3 id="4-1-设置不解析域名提升速度"><a href="#4-1-设置不解析域名提升速度" class="headerlink" title="4.1 设置不解析域名提升速度#"></a>4.1 设置不解析域名提升速度<a href="#idx_11">#</a></h3><ul>
<li><code>-n</code>：不把 ip 转化成域名，直接显示 ip，避免执行 DNS lookups 的过程，速度会快很多</li>
<li><code>-nn</code>：不把协议和端口号转化成名字，速度也会快很多。</li>
<li><code>-N</code>：不打印出 host 的域名部分.。比如,，如果设置了此选现，tcpdump 将会打印’nic’ 而不是’nic.ddn.mil’.</li>
</ul>
<h3 id="4-2-过滤结果输出到文件"><a href="#4-2-过滤结果输出到文件" class="headerlink" title="4.2 过滤结果输出到文件#"></a>4.2 过滤结果输出到文件<a href="#idx_12">#</a></h3><p>使用 tcpdump 工具抓到包后，往往需要再借助其他的工具进行分析，比如常见的 wireshark 。</p>
<p>而要使用 wireshark ，我们得将 tcpdump 抓到的包数据生成到文件中，最后再使用 wireshark 打开它即可。</p>
<p>使用 <code>-w</code> 参数后接一个以 <code>.pcap</code> 后缀命令的文件名，就可以将 tcpdump 抓到的数据保存到文件中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump icmp -w icmp.pcap</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-3-从文件中读取包数据"><a href="#4-3-从文件中读取包数据" class="headerlink" title="4.3 从文件中读取包数据#"></a>4.3 从文件中读取包数据<a href="#idx_13">#</a></h3><p>使用 <code>-w</code> 是写入数据到文件，而使用 <code>-r</code> 是从文件中读取数据。</p>
<p>读取后，我们照样可以使用上述的过滤器语法进行过滤分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump icmp -r all.pcap</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-4-控制详细内容的输出"><a href="#4-4-控制详细内容的输出" class="headerlink" title="4.4 控制详细内容的输出#"></a>4.4 控制详细内容的输出<a href="#idx_14">#</a></h3><ul>
<li><code>-v</code>：产生详细的输出. 比如包的 TTL，id 标识，数据包长度，以及 IP 包的一些选项。同时它还会打开一些附加的包完整性检测，比如对 IP 或 ICMP 包头部的校验和。</li>
<li><code>-vv</code>：产生比 - v 更详细的输出. 比如 NFS 回应包中的附加域将会被打印, SMB 数据包也会被完全解码。（摘自网络，目前我还未使用过）</li>
<li><code>-vvv</code>：产生比 - vv 更详细的输出。比如 telent 时所使用的 SB, SE 选项将会被打印, 如果 telnet 同时使用的是图形界面，其相应的图形选项将会以 16 进制的方式打印出来（摘自网络，目前我还未使用过）</li>
</ul>
<h3 id="4-5-控制时间的显示"><a href="#4-5-控制时间的显示" class="headerlink" title="4.5 控制时间的显示#"></a>4.5 控制时间的显示<a href="#idx_15">#</a></h3><ul>
<li><code>-t</code> ：在每行的输出中不输出时间</li>
<li><code>-tt</code>：在每行的输出中会输出时间戳</li>
<li><code>-ttt</code>：输出每两行打印的时间间隔 (以毫秒为单位)</li>
<li><code>-tttt</code>：在每行打印的时间戳之前添加日期的打印（此种选项，输出的时间最直观）</li>
</ul>
<h3 id="4-6-显示数据包的头部"><a href="#4-6-显示数据包的头部" class="headerlink" title="4.6 显示数据包的头部#"></a>4.6 显示数据包的头部<a href="#idx_16">#</a></h3><ul>
<li><code>-x</code>：以 16 进制的形式打印每个包的头部数据（但不包括数据链路层的头部）</li>
<li><code>-xx</code>：以 16 进制的形式打印每个包的头部数据（包括数据链路层的头部）</li>
<li><code>-X</code>：以 16 进制和 ASCII 码形式打印出每个包的数据 (但不包括连接层的头部)，这在分析一些新协议的数据包很方便。</li>
<li><code>-XX</code>：以 16 进制和 ASCII 码形式打印出每个包的数据 (包括连接层的头部)，这在分析一些新协议的数据包很方便。</li>
</ul>
<h3 id="4-7-过滤指定网卡的数据包"><a href="#4-7-过滤指定网卡的数据包" class="headerlink" title="4.7 过滤指定网卡的数据包#"></a>4.7 过滤指定网卡的数据包<a href="#idx_17">#</a></h3><ul>
<li><code>-i</code>：指定要过滤的网卡接口，如果要查看所有网卡，可以 <code>-i any</code></li>
</ul>
<h3 id="4-8-过滤特定流向的数据包"><a href="#4-8-过滤特定流向的数据包" class="headerlink" title="4.8 过滤特定流向的数据包#"></a>4.8 过滤特定流向的数据包<a href="#idx_18">#</a></h3><ul>
<li><code>-Q</code>： 选择是入方向还是出方向的数据包，可选项有：in, out, inout，也可以使用 –direction&#x3D;[direction] 这种写法</li>
</ul>
<h3 id="4-9-其他常用的一些参数"><a href="#4-9-其他常用的一些参数" class="headerlink" title="4.9 其他常用的一些参数#"></a>4.9 其他常用的一些参数<a href="#idx_19">#</a></h3><ul>
<li><p><code>-A</code>：以 ASCII 码方式显示每一个数据包 (不显示链路层头部信息). 在抓取包含网页数据的数据包时, 可方便查看数据</p>
</li>
<li><p><code>-l</code> : 基于行的输出，便于你保存查看，或者交给其它工具分析</p>
</li>
<li><p><code>-q</code> : 简洁地打印输出。即打印很少的协议相关信息, 从而输出行都比较简短.</p>
</li>
<li><p><code>-c</code> : 捕获 count 个包 tcpdump 就退出</p>
</li>
<li><p><code>-s</code> : tcpdump 默认只会截取前 <code>96</code> 字节的内容，要想截取所有的报文内容，可以使用 <code>-s number</code>， <code>number</code> 就是你要截取的报文字节数，如果是 0 的话，表示截取报文全部内容。</p>
</li>
<li><p><code>-S</code> : 使用绝对序列号，而不是相对序列号</p>
</li>
<li><p><code>-C</code>：file-size，tcpdump 在把原始数据包直接保存到文件中之前, 检查此文件大小是否超过 file-size. 如果超过了, 将关闭此文件, 另创一个文件继续用于原始数据包的记录. 新创建的文件名与 - w 选项指定的文件名一致, 但文件名后多了一个数字. 该数字会从 1 开始随着新创建文件的增多而增加. file-size 的单位是百万字节 (nt: 这里指 1,000,000 个字节, 并非 1,048,576 个字节, 后者是以 1024 字节为 1k, 1024k 字节为 1M 计算所得, 即 1M&#x3D;1024 ＊ 1024 ＝ 1,048,576)</p>
</li>
<li><p><code>-F</code>：使用 file 文件作为过滤条件表达式的输入, 此时命令行上的输入将被忽略.</p>
</li>
</ul>
<h3 id="4-10-对输出内容进行控制的参数"><a href="#4-10-对输出内容进行控制的参数" class="headerlink" title="4.10 对输出内容进行控制的参数#"></a>4.10 对输出内容进行控制的参数<a href="#idx_20">#</a></h3><ul>
<li><code>-D</code> : 显示所有可用网络接口的列表</li>
<li><code>-e</code> : 每行的打印输出中将包括数据包的数据链路层头部信息</li>
<li><code>-E</code> : 揭秘 IPSEC 数据</li>
<li><code>-L</code> ：列出指定网络接口所支持的数据链路层的类型后退出</li>
<li><code>-Z</code>：后接用户名，在抓包时会受到权限的限制。如果以 root 用户启动 tcpdump，tcpdump 将会有超级用户权限。</li>
<li><code>-d</code>：打印出易读的包匹配码</li>
<li><code>-dd</code>：以 C 语言的形式打印出包匹配码.</li>
<li><code>-ddd</code>：以十进制数的形式打印出包匹配码</li>
</ul>
<ol start="5">
<li>过滤规则组合<a href="#idx_21">#</a></li>
</ol>
<hr>
<p>有编程基础的同学，对于下面三个逻辑运算符应该不陌生了吧</p>
<ul>
<li>and：所有的条件都需要满足，也可以表示为 <code>&amp;&amp;</code></li>
<li>or：只要有一个条件满足就可以，也可以表示为 <code>||</code></li>
<li>not：取反，也可以使用 <code>!</code></li>
</ul>
<p>举个例子，我想需要抓一个来自<code>10.5.2.3</code>，发往任意主机的 3389 端口的包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src 10.5.2.3 and dst port 3389</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当你在使用多个过滤器进行组合时，有可能需要用到括号，而括号在 shell 中是特殊符号，因为你需要使用引号将其包含。例子如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &#x27;src 10.0.2.4 and (dst port 3389 or 22)&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而在单个过滤器里，常常会判断一条件是否成立，这时候，就要使用下面两个符号</p>
<ul>
<li><code>=</code>：判断二者相等</li>
<li><code>==</code>：判断二者相等</li>
<li><code>!=</code>：判断二者不相等</li>
</ul>
<p>当你使用这两个符号时，tcpdump 还提供了一些关键字的接口来方便我们进行判断，比如</p>
<ul>
<li>if：表示网卡接口名、</li>
<li>proc：表示进程名</li>
<li>pid：表示进程 id</li>
<li>svc：表示 service class</li>
<li>dir：表示方向，in 和 out</li>
<li>eproc：表示 effective process name</li>
<li>epid：表示 effective process ID</li>
</ul>
<p>比如我现在要过滤来自进程名为 <code>nc</code> 发出的流经 en0 网卡的数据包，或者不流经 en0 的入方向数据包，可以这样子写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &quot;( if=en0 and proc =nc ) || (if != en0 and dir=in)&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>特殊过滤规则<a href="#idx_22">#</a></li>
</ol>
<hr>
<h3 id="5-1-根据-tcpflags-进行过滤"><a href="#5-1-根据-tcpflags-进行过滤" class="headerlink" title="5.1 根据 tcpflags 进行过滤#"></a>5.1 根据 tcpflags 进行过滤<a href="#idx_23">#</a></h3><p>通过<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzMzMzOTI3Nw==&mid=2247488180&idx=1&sn=09526224732ebfcccb52847f27298c70&chksm=e8867256dff1fb40c9f47bafd0e87a9237c5a9ebf33c8a3d0a598276b496d29cdaa3fbff8d26&token=1970357830&lang=zh_CN#rd">上一篇文章</a>，我们知道了 tcp 的首部有一个标志位。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://image.iswbm.com/20200606095627.png"></p>
<p>tcpdump 支持我们根据数据包的标志位进行过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proto [ expr:size ]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>proto</code>：可以是熟知的协议之一（如 ip，arp，tcp，udp，icmp，ipv6）</p>
</li>
<li><p><code>expr</code>：可以是数值，也可以是一个表达式，表示与指定的协议头开始处的字节偏移量。</p>
</li>
<li><p><code>size</code>：是可选的，表示从字节偏移量开始取的字节数量。</p>
</li>
</ul>
<p>接下来，我将举几个例子，让人明白它的写法，不过在那之前，有几个点需要你明白，这在后面的例子中会用到：</p>
<p><strong>1、</strong>tcpflags 可以理解为是一个别名常量，相当于 13，它代表着与指定的协议头开头相关的字节偏移量，也就是标志位，所以 tcp[tcpflags] 等价于 tcp[13] ，对应下图中的报文位置。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://image.iswbm.com/20200628222034.png"></p>
<p><strong>2、</strong>tcp-fin, tcp-syn, tcp-rst, tcp-push, tcp-ack, tcp-urg 这些同样可以理解为别名常量，分别代表 1，2，4，8，16，32，64。这些数字是如何计算出来的呢？</p>
<p>以 tcp-syn 为例，你可以参照下面这张图，计算出来的值 是就是 2</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://image.iswbm.com/20200628222010.png"></p>
<p>由于数字不好记忆，所以一般使用这样的 “别名常量” 表示。</p>
<p>因此当下面这个表达式成立时，就代表这个包是一个 syn 包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcp[tcpflags] == tcp-syn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>要抓取特定数据包，方法有很多种。</p>
<p>下面以最常见的 syn 包为例，演示一下如何用 tcpdump 抓取到 syn 包，而其他的类型的包也是同样的道理。</p>
<p>据我总结，主要有三种写法：</p>
<p>1、第一种写法：使用数字表示偏移量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &quot;tcp[13] &amp; 2 != 0&quot; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、第二种写法：使用别名常量表示偏移量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &quot;tcp[tcpflags] &amp; tcp-syn != 0&quot; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、第三种写法：使用混合写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &quot;tcp[tcpflags] &amp; 2 != 0&quot; </span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump -i eth0 &quot;tcp[13] &amp; tcp-syn != 0&quot; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果我想同时捕获多种类型的包呢，比如 syn + ack 包</p>
<p>1、第一种写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &#x27;tcp[13] == 2 or tcp[13] == 16&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、第二种写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &#x27;tcp[tcpflags] == tcp-syn or tcp[tcpflags] == tcp-ack&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、第三种写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、第四种写法：注意这里是 单个等号，而不是像上面一样两个等号，18（syn+ack） &#x3D; 2（syn） + 16（ack）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 &#x27;tcp[13] = 18&#x27;</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump -i eth0 &#x27;tcp[tcpflags] = 18&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>tcp 中有 类似 tcp-syn 的别名常量，其他协议也是有的，比如 icmp 协议，可以使用的别名常量有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">icmp-echoreply, icmp-unreach, icmp-sourcequench, </span><br><span class="line">icmp-redirect, icmp-echo, icmp-routeradvert,</span><br><span class="line">icmp-routersolicit, icmp-timx-ceed, icmp-paramprob, </span><br><span class="line">icmp-tstamp, icmp-tstampreply,icmp-ireq, </span><br><span class="line">icmp-ireqreply, icmp-maskreq, icmp-maskreply</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-2-基于包大小进行过滤"><a href="#5-2-基于包大小进行过滤" class="headerlink" title="5.2 基于包大小进行过滤#"></a>5.2 基于包大小进行过滤<a href="#idx_24">#</a></h3><p>若你想查看指定大小的数据包，也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump less 32 </span><br><span class="line">$ tcpdump greater 64 </span><br><span class="line">$ tcpdump &lt;= 128</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-3-根据-mac-地址进行过滤"><a href="#5-3-根据-mac-地址进行过滤" class="headerlink" title="5.3 根据 mac 地址进行过滤#"></a>5.3 根据 mac 地址进行过滤<a href="#idx_25">#</a></h3><p>例子如下，其中 ehost 是记录在 &#x2F;etc&#x2F;ethers 里的 name</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump ether host [ehost]</span><br><span class="line">$ tcpdump ether dst	[ehost]</span><br><span class="line">$ tcpdump ether src	[ehost]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-4-过滤通过指定网关的数据包"><a href="#5-4-过滤通过指定网关的数据包" class="headerlink" title="5.4 过滤通过指定网关的数据包#"></a>5.4 过滤通过指定网关的数据包<a href="#idx_26">#</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump gateway [host]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-5-过滤广播-x2F-多播数据包"><a href="#5-5-过滤广播-x2F-多播数据包" class="headerlink" title="5.5 过滤广播 &#x2F; 多播数据包#"></a>5.5 过滤广播 &#x2F; 多播数据包<a href="#idx_27">#</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump ether broadcast</span><br><span class="line">$ tcpdump ether multicast</span><br><span class="line"></span><br><span class="line">$ tcpdump ip broadcast</span><br><span class="line">$ tcpdump ip multicast</span><br><span class="line"></span><br><span class="line">$ tcpdump ip6 multicast</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>如何抓取到更精准的包？<a href="#idx_28">#</a></li>
</ol>
<hr>
<p>先给你抛出一个问题：如果我只想抓取 HTTP 的 POST 请求该如何写呢？</p>
<p>如果只学习了上面的内容，恐怕你还是无法写法满足这个抓取需求的过滤器。</p>
<p>在学习之前，我先给出答案，然后再剖析一下，这个过滤器是如何生效的，居然能让我们对包内的内容进行判断。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s 0 -A -vv &#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>命令里的可选参数，在前面的内容里已经详细讲过了。这里不再细讲。</p>
<p>本节的重点是引号里的内容，看起来很复杂的样子。</p>
<p>将它逐一分解，我们只要先理解了下面几种用法，就能明白</p>
<ul>
<li><p><code>tcp[n]</code>：表示 tcp 报文里 第 n 个字节</p>
</li>
<li><p><code>tcp[n:c]</code>：表示 tcp 报文里从第 n 个字节开始取 c 个字节，tcp[12:1] 表示从报文的第 12 个字节（因为有第 0 个字节，所以这里的 12 其实表示的是 13）开始算起取一个字节，也就是 8 个 bit。查看 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol#TCP_segment_structure">tcp 的报文首部结构</a>，可以得知这 8 个 bit 其实就是下图中的红框圈起来的位置，而在这里我们只要前面 4 个 bit，也就是实际数据在整个报文首部中的偏移量。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://image.iswbm.com/20200629085659.png"></p>
</li>
<li><p><code>&amp;</code>：是<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bitwise_operation">位运算</a>里的 and 操作符，比如 <code>0011 &amp; 0010 = 0010</code></p>
</li>
<li><p><code>&gt;&gt;</code>：是位运算里的右移操作，比如 <code>0111 &gt;&gt; 2 = 0001</code></p>
</li>
<li><p><code>0xf0</code>：是 10 进制的 240 的 16 进制表示，但对于位操作来说，10 进制和 16 进制都将毫无意义，我们需要的是二进制，将其转换成二进制后是：11110000，这个数有什么特点呢？前面个 4bit 全部是 1，后面 4 个 bit 全部是 0，往后看你就知道这个特点有什么用了。</p>
</li>
</ul>
<p>分解完后，再慢慢合并起来看</p>
<p>1、<code>tcp[12:1] &amp; 0xf0</code> 其实并不直观，但是我们将它换一种写法，就好看多了，假设 tcp 报文中的 第 12 个字节是这样组成的 <code>10110000</code>，那么这个表达式就可以变成 10110110 &amp;&amp; 11110000 &#x3D; 10110000，得到了 10110000 后，再进入下一步。</p>
<p>2、<code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> ：如果你不理解 tcp 报文首部里的数据偏移，请先点击这个前往我的<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzMzMzOTI3Nw==&mid=2247488180&idx=1&sn=09526224732ebfcccb52847f27298c70&chksm=e8867256dff1fb40c9f47bafd0e87a9237c5a9ebf33c8a3d0a598276b496d29cdaa3fbff8d26&token=1970357830&lang=zh_CN#rd">上一篇文章</a>，搞懂数据偏移的意义，否则我保证你这里会绝对会听懵了。</p>
<p><code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> 这个表达式实际是 <code>(tcp[12:1] &amp; 0xf0) &gt;&gt; 4 ) &lt;&lt; 2</code> 的简写形式。所以要搞懂 <code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> 只要理解了<code>(tcp[12:1] &amp; 0xf0) &gt;&gt; 4 ) &lt;&lt; 2</code> 就行了 。</p>
<p>从上一步我们算出了 <code>tcp[12:1] &amp; 0xf0</code> 的值其实是一个字节，也就是 8 个 bit，但是你再回去看下上面的 tcp 报文首部结构图，表示数据偏移量的只有 4 个 bit，也就是说 上面得到的值 10110000，前面 4 位（1011）才是正确的偏移量，那么为了得到 1011，只需要将 10110000 右移 4 位即可，也就是 <code>tcp[12:1] &amp; 0xf0) &gt;&gt; 4</code>，至此我们是不是已经得出了实际数据的正确位置呢，很遗憾还没有，前一篇文章里我们讲到 Data Offset 的单位是 4 个字节，因为要将 1011 乘以 4 才可以，除以 4 在位运算中相当于左移 2 位，也就是 <code>&lt;&lt;2</code>，与前面的 <code>&gt;&gt;4</code> 结合起来一起算的话，最终的运算可以简化为 <code>&gt;&gt;2</code>。</p>
<p>至此，我们终于得出了实际数据开始的位置是 <code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> （单位是字节）。</p>
<p>找到了数据的起点后，可别忘了我们的目的是从数据中打到 HTTP 请求的方法，是 GET 呢 还是 POST ，或者是其他的？</p>
<p>有了上面的经验，我们自然懂得使用 <code>tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]</code> 从数据开始的位置再取出四个字节，然后将结果与 <code>GET</code> （注意 GET 最后还有个空格）的 16 进制写法（也就是 <code>0x47455420</code>）进行比对。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x47   --&gt;   71    --&gt;  G</span><br><span class="line">0x45   --&gt;   69    --&gt;  E</span><br><span class="line">0x54   --&gt;   84    --&gt;  T</span><br><span class="line">0x20   --&gt;   32    --&gt;  空格</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://image.iswbm.com/20200629130407.png"></p>
<p>如果相等，则该表达式为 True，tcpdump 认为这就是我们所需要抓的数据包，将其输出到我们的终端屏幕上。</p>
<ol start="8">
<li>抓包实战应用例子<a href="#idx_29">#</a></li>
</ol>
<hr>
<h3 id="8-1-提取-HTTP-的-User-Agent"><a href="#8-1-提取-HTTP-的-User-Agent" class="headerlink" title="8.1 提取 HTTP 的 User-Agent#"></a>8.1 提取 HTTP 的 User-Agent<a href="#idx_30">#</a></h3><p>从 HTTP 请求头中提取 HTTP 的 User-Agent：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s1500 -l | grep &quot;User-Agent:&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过 <code>egrep</code> 可以同时提取 User-Agent 和主机名（或其他头文件）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s1500 -l | egrep -i &#x27;User-Agent:|Host:&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-2-抓取-HTTP-GET-和-POST-请求"><a href="#8-2-抓取-HTTP-GET-和-POST-请求" class="headerlink" title="8.2 抓取 HTTP GET 和 POST 请求#"></a>8.2 抓取 HTTP GET 和 POST 请求<a href="#idx_31">#</a></h3><p>抓取 HTTP GET 请求包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s 0 -A -vv &#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420&#x27;</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">$ tcpdump -vvAls0 | grep &#x27;GET&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以抓取 HTTP POST 请求包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s 0 -A -vv &#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&#x27;</span><br><span class="line"></span><br><span class="line"># or </span><br><span class="line"></span><br><span class="line">$ tcpdump -vvAls0 | grep &#x27;POST&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：该方法不能保证抓取到 HTTP POST 有效数据流量，因为一个 POST 请求会被分割为多个 TCP 数据包。</p>
<h3 id="8-3-找出发包数最多的-IP"><a href="#8-3-找出发包数最多的-IP" class="headerlink" title="8.3 找出发包数最多的 IP#"></a>8.3 找出发包数最多的 IP<a href="#idx_32">#</a></h3><p>找出一段时间内发包最多的 IP，或者从一堆报文中找出发包最多的 IP，可以使用下面的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nnn -t -c 200 | cut -f 1,2,3,4 -d &#x27;.&#x27; | sort | uniq -c | sort -nr | head -n 20</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>cut -f 1,2,3,4 -d ‘.’</strong> : 以 <code>.</code> 为分隔符，打印出每行的前四列。即 IP 地址。</li>
<li><strong>sort | uniq -c</strong> : 排序并计数</li>
<li><strong>sort -nr</strong> : 按照数值大小逆向排序</li>
</ul>
<h3 id="8-4-抓取-DNS-请求和响应"><a href="#8-4-抓取-DNS-请求和响应" class="headerlink" title="8.4 抓取 DNS 请求和响应#"></a>8.4 抓取 DNS 请求和响应<a href="#idx_33">#</a></h3><p>DNS 的默认端口是 53，因此可以通过端口进行过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i any -s0 port 53</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-5-切割-pcap-文件"><a href="#8-5-切割-pcap-文件" class="headerlink" title="8.5 切割 pcap 文件#"></a>8.5 切割 pcap 文件<a href="#idx_34">#</a></h3><p>当抓取大量数据并写入文件时，可以自动切割为多个大小相同的文件。例如，下面的命令表示每 3600 秒创建一个新文件 <code>capture-(hour).pcap</code>，每个文件大小不超过 <code>200*1000000</code> 字节：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump  -w /tmp/capture-%H.pcap -G 3600 -C 200</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这些文件的命名为 <code>capture-&#123;1-24&#125;.pcap</code>，24 小时之后，之前的文件就会被覆盖。</p>
<h3 id="8-6-提取-HTTP-POST-请求中的密码"><a href="#8-6-提取-HTTP-POST-请求中的密码" class="headerlink" title="8.6 提取 HTTP POST 请求中的密码#"></a>8.6 提取 HTTP POST 请求中的密码<a href="#idx_35">#</a></h3><p>从 HTTP POST 请求中提取密码和主机名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s 0 -A -n -l | egrep -i &quot;POST /|pwd=|passwd=|password=|Host:&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-7-提取-HTTP-请求的-URL"><a href="#8-7-提取-HTTP-请求的-URL" class="headerlink" title="8.7 提取 HTTP 请求的 URL#"></a>8.7 提取 HTTP 请求的 URL<a href="#idx_36">#</a></h3><p>提取 HTTP 请求的主机名和路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s 0 -v -n -l | egrep -i &quot;POST /|GET /|Host:&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-8-抓取-HTTP-有效数据包"><a href="#8-8-抓取-HTTP-有效数据包" class="headerlink" title="8.8 抓取 HTTP 有效数据包#"></a>8.8 抓取 HTTP 有效数据包<a href="#idx_37">#</a></h3><p>抓取 80 端口的 HTTP 有效数据包，排除 TCP 连接建立过程的数据包（SYN &#x2F; FIN &#x2F; ACK）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump &#x27;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-9-结合-Wireshark-进行分析"><a href="#8-9-结合-Wireshark-进行分析" class="headerlink" title="8.9 结合 Wireshark 进行分析#"></a>8.9 结合 Wireshark 进行分析<a href="#idx_38">#</a></h3><p>通常 <code>Wireshark</code>（或 tshark）比 tcpdump 更容易分析应用层协议。一般的做法是在远程服务器上先使用 <code>tcpdump</code> 抓取数据并写入文件，然后再将文件拷贝到本地工作站上用 <code>Wireshark</code> 分析。</p>
<p>还有一种更高效的方法，可以通过 ssh 连接将抓取到的数据实时发送给 Wireshark 进行分析。以 MacOS 系统为例，可以通过 <code>brew cask install wireshark</code> 来安装，然后通过下面的命令来分析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@remotesystem &#x27;tcpdump -s0 -c 1000 -nn -w - not port 22&#x27; | /Applications/Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例如，如果想分析 DNS 协议，可以使用下面的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@remotesystem &#x27;tcpdump -s0 -c 1000 -nn -w - port 53&#x27; | /Applications/Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>抓取到的数据：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/20200210170101.png"></p>
<p><code>-c</code> 选项用来限制抓取数据的大小。如果不限制大小，就只能通过 <code>ctrl-c</code> 来停止抓取，这样一来不仅关闭了 tcpdump，也关闭了 wireshark。</p>
<p>到这里，我已经将我所知道的 tcpdump 的用法全部说了一遍，如果你有认真地看完本文，相信会有不小的收获，掌握一个上手的抓包工具，对于以后我们学习网络、分析网络协议、以及定位网络问题，会很有帮助，而 tcpdump 是我推荐的一个抓包工具。</p>
<ol start="9">
<li>参考文章<a href="#idx_39">#</a></li>
</ol>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.freebsd.org/cgi/man.cgi?query=tcpdump&apropos=0&sektion=0&manpath=FreeBSD+7.2-RELEASE&format=html">FreeBSD Manual Pages About tcpdump</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ggjucheng/archive/2012/01/14/2322659.html">Linux tcpdump 命令详解</a></li>
<li><a target="_blank" rel="noopener" href="http://team.jiunile.com/blog/2019/06/tcpdump.html">一份快速实用的 tcpdump 命令参考手册</a></li>
<li><a target="_blank" rel="noopener" href="https://fuckcloudnative.io/posts/tcpdump-examples/">超详细的网络抓包神器 tcpdump 使用指南</a></li>
<li><a target="_blank" rel="noopener" href="https://colobu.com/2019/07/16/a-tcpdump-tutorial-with-examples/">[译]tcpdump 示例教程</a></li>
<li><a target="_blank" rel="noopener" href="https://danielmiessler.com/study/tcpdump/">[英]tcpdump 示例教程</a></li>
</ol>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">哪吒藕霸</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/')">tcpdump 使用指南</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=tcpdump 使用指南&amp;url=https://shippomx.github.io/2020/05/11/tcpdump%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shippomx.github.io" target="_blank">远辰</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>linux<span class="tagsPageCount">40</span></a><a class="post-meta__box__tags" href="/tags/network/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>network<span class="tagsPageCount">8</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/05/11/golang/%E4%BD%BF%E7%94%A8%20gosec%20%E6%A3%80%E6%9F%A5%20Go%20%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">使用gosec检查Go代码中安全问题</div></div></a></div><div class="next-post pull-right"><a href="/2020/05/11/golang/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%8F%8D%E5%B0%84/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">深入理解Golang的反射</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2022/12/23/sdn/dpdk%E7%BC%96%E8%AF%91/" title="DPDK编译"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">DPDK编译</div></div></a></div><div><a href="/2022/12/23/sdn/%E5%86%85%E6%A0%B8%20skb_sk_buff%20%E8%AF%A6%E8%A7%A3/" title="内核skb_sk_buff详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">内核skb_sk_buff详解</div></div></a></div><div><a href="/2022/12/23/sdn/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0ring%20buffer/" title="如何实现ring buffer"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">如何实现ring buffer</div></div></a></div><div><a href="/2022/12/23/%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%B5%8B%E9%87%8F%E5%B7%A5%E5%85%B7%20iperf%20%E4%B8%8E%20netperf/" title="网络性能测量工具iperf和netperf"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">网络性能测量工具iperf和netperf</div></div></a></div><div><a href="/2022/12/23/sdn/Tcpreplay%20%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" title="TCPReplay的简单使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">TCPReplay的简单使用</div></div></a></div><div><a href="/2022/12/23/sdn/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E6%A0%BC%E5%BC%8F/" title="以太网帧格式"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">以太网帧格式</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">2.1 输出内容结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Flags-%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="toc-number">2.</span> <span class="toc-text">2.2 Flags 标识符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9F%BA%E4%BA%8E-IP-%E5%9C%B0%E5%9D%80%E8%BF%87%E6%BB%A4%EF%BC%9Ahost"><span class="toc-number">3.</span> <span class="toc-text">3.1 基于 IP 地址过滤：host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%9F%BA%E4%BA%8E%E7%BD%91%E6%AE%B5%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%EF%BC%9Anet"><span class="toc-number">4.</span> <span class="toc-text">3.2 基于网段进行过滤：net</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%EF%BC%9Aport"><span class="toc-number">5.</span> <span class="toc-text">3.3 基于端口进行过滤：port</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%9F%BA%E4%BA%8E%E5%8D%8F%E8%AE%AE%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%EF%BC%9Aproto"><span class="toc-number">6.</span> <span class="toc-text">3.4 基于协议进行过滤：proto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%9F%BA%E6%9C%AC-IP-%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%89%88%E6%9C%AC%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">3.5 基本 IP 协议的版本进行过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%AE%BE%E7%BD%AE%E4%B8%8D%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8D%E6%8F%90%E5%8D%87%E9%80%9F%E5%BA%A6"><span class="toc-number">8.</span> <span class="toc-text">4.1 设置不解析域名提升速度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%BF%87%E6%BB%A4%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">4.2 过滤结果输出到文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%8C%85%E6%95%B0%E6%8D%AE"><span class="toc-number">10.</span> <span class="toc-text">4.3 从文件中读取包数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E6%8E%A7%E5%88%B6%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9%E7%9A%84%E8%BE%93%E5%87%BA"><span class="toc-number">11.</span> <span class="toc-text">4.4 控制详细内容的输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E6%8E%A7%E5%88%B6%E6%97%B6%E9%97%B4%E7%9A%84%E6%98%BE%E7%A4%BA"><span class="toc-number">12.</span> <span class="toc-text">4.5 控制时间的显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E5%A4%B4%E9%83%A8"><span class="toc-number">13.</span> <span class="toc-text">4.6 显示数据包的头部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E8%BF%87%E6%BB%A4%E6%8C%87%E5%AE%9A%E7%BD%91%E5%8D%A1%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">14.</span> <span class="toc-text">4.7 过滤指定网卡的数据包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E8%BF%87%E6%BB%A4%E7%89%B9%E5%AE%9A%E6%B5%81%E5%90%91%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">15.</span> <span class="toc-text">4.8 过滤特定流向的数据包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%82%E6%95%B0"><span class="toc-number">16.</span> <span class="toc-text">4.9 其他常用的一些参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-%E5%AF%B9%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%E8%BF%9B%E8%A1%8C%E6%8E%A7%E5%88%B6%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">17.</span> <span class="toc-text">4.10 对输出内容进行控制的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%A0%B9%E6%8D%AE-tcpflags-%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">18.</span> <span class="toc-text">5.1 根据 tcpflags 进行过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%9F%BA%E4%BA%8E%E5%8C%85%E5%A4%A7%E5%B0%8F%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">19.</span> <span class="toc-text">5.2 基于包大小进行过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%A0%B9%E6%8D%AE-mac-%E5%9C%B0%E5%9D%80%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">20.</span> <span class="toc-text">5.3 根据 mac 地址进行过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E8%BF%87%E6%BB%A4%E9%80%9A%E8%BF%87%E6%8C%87%E5%AE%9A%E7%BD%91%E5%85%B3%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">21.</span> <span class="toc-text">5.4 过滤通过指定网关的数据包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E8%BF%87%E6%BB%A4%E5%B9%BF%E6%92%AD-x2F-%E5%A4%9A%E6%92%AD%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">22.</span> <span class="toc-text">5.5 过滤广播 &#x2F; 多播数据包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E6%8F%90%E5%8F%96-HTTP-%E7%9A%84-User-Agent"><span class="toc-number">23.</span> <span class="toc-text">8.1 提取 HTTP 的 User-Agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E6%8A%93%E5%8F%96-HTTP-GET-%E5%92%8C-POST-%E8%AF%B7%E6%B1%82"><span class="toc-number">24.</span> <span class="toc-text">8.2 抓取 HTTP GET 和 POST 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E6%89%BE%E5%87%BA%E5%8F%91%E5%8C%85%E6%95%B0%E6%9C%80%E5%A4%9A%E7%9A%84-IP"><span class="toc-number">25.</span> <span class="toc-text">8.3 找出发包数最多的 IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E6%8A%93%E5%8F%96-DNS-%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94"><span class="toc-number">26.</span> <span class="toc-text">8.4 抓取 DNS 请求和响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-%E5%88%87%E5%89%B2-pcap-%E6%96%87%E4%BB%B6"><span class="toc-number">27.</span> <span class="toc-text">8.5 切割 pcap 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E6%8F%90%E5%8F%96-HTTP-POST-%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">28.</span> <span class="toc-text">8.6 提取 HTTP POST 请求中的密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-%E6%8F%90%E5%8F%96-HTTP-%E8%AF%B7%E6%B1%82%E7%9A%84-URL"><span class="toc-number">29.</span> <span class="toc-text">8.7 提取 HTTP 请求的 URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-%E6%8A%93%E5%8F%96-HTTP-%E6%9C%89%E6%95%88%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">30.</span> <span class="toc-text">8.8 抓取 HTTP 有效数据包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-9-%E7%BB%93%E5%90%88-Wireshark-%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><span class="toc-number">31.</span> <span class="toc-text">8.9 结合 Wireshark 进行分析</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/" title="无题">无题</a><time datetime="2024-08-13T07:48:29.025Z" title="发表于 2024-08-13 15:48:29">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/13/linux/%E5%86%85%E5%AD%98/%E9%A1%B5%E8%A1%A8/" title="无题">无题</a><time datetime="2024-08-13T06:57:36.023Z" title="发表于 2024-08-13 14:57:36">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/13/containers/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%20%5B%E4%B8%80%5D%20-%20%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/" title="无题">无题</a><time datetime="2024-08-13T06:50:07.571Z" title="发表于 2024-08-13 14:50:07">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/linux/%E5%86%85%E5%AD%98/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20Linux%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" title="无题">无题</a><time datetime="2024-08-12T03:18:47.311Z" title="发表于 2024-08-12 11:18:47">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/31/sdn/dpdk/" title="无题">无题</a><time datetime="2024-07-31T11:36:18.019Z" title="发表于 2024-07-31 19:36:18">2024-07-31</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="哪吒藕霸" target="_blank">哪吒藕霸</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">101</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DPDK/" style="font-size: 0.88rem;">DPDK<sup>3</sup></a><a href="/tags/ONOS/" style="font-size: 0.88rem;">ONOS<sup>1</sup></a><a href="/tags/algorithm/" style="font-size: 0.88rem;">algorithm<sup>1</sup></a><a href="/tags/blockchain/" style="font-size: 0.88rem;">blockchain<sup>1</sup></a><a href="/tags/c/" style="font-size: 0.88rem;">c<sup>1</sup></a><a href="/tags/configuration/" style="font-size: 0.88rem;">configuration<sup>1</sup></a><a href="/tags/container/" style="font-size: 0.88rem;">container<sup>25</sup></a><a href="/tags/go/" style="font-size: 0.88rem;">go<sup>14</sup></a><a href="/tags/kidgets/" style="font-size: 0.88rem;">kidgets<sup>3</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>40</sup></a><a href="/tags/network/" style="font-size: 0.88rem;">network<sup>8</sup></a><a href="/tags/rust/" style="font-size: 0.88rem;">rust<sup>6</sup></a><a href="/tags/sdn/" style="font-size: 0.88rem;">sdn<sup>4</sup></a><a href="/tags/systemtap/" style="font-size: 0.88rem;">systemtap<sup>4</sup></a><a href="/tags/tools/" style="font-size: 0.88rem;">tools<sup>1</sup></a><a href="/tags/tvbox/" style="font-size: 0.88rem;">tvbox<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 哪吒藕霸 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>