<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>远辰 | 远辰</title><meta name="author" content="哪吒藕霸"><meta name="copyright" content="哪吒藕霸"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="远辰"><meta name="application-name" content="远辰"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="远辰"><meta property="og:url" content="https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/index.html"><meta property="og:site_name" content="远辰"><meta property="og:description" content="本文由 简悦 SimpRead 转码， 原文地址 blog.csdn.net  前言前面我们学习了 8259A，但 8259A 只适合单 CPU 的情况，为了充分挖掘 SMP 体系结构的并行性，能够把中断传递给系统中的每个 CPU 至关重要。基于此理由，Intel 引入了一种名为 I&amp;#x2F;O"><meta property="og:locale" content="zh"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="哪吒藕霸"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="本文由 简悦 SimpRead 转码， 原文地址 blog.csdn.net  前言前面我们学习了 8259A，但 8259A 只适合单 CPU 的情况，为了充分挖掘 SMP 体系结构的并行性，能够把中断传递给系统中的每个 CPU 至关重要。基于此理由，Intel 引入了一种名为 I&amp;#x2F;O"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 哪吒藕霸","link":"链接: ","source":"来源: 远辰","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '远辰',
  title: '远辰',
  postAI: '',
  pageFillDescription: '前言, 0 APIC 概述, 1 APIC, 2 LAPIC, 3 IO APIC, 4、APIC 与 8259A, 小结, 参考资料本文由简悦转码原文地址前言前面我们学习了但只适合单的情况为了充分挖掘体系结构的并行性能够把中断传递给系统中的每个至关重要基于此理由引入了一种名为高级可编程控制器的新组件来替代老式的可编程中断控制器下面一起来学习一下概述从处理器开始引入了机制直译为高级可编程中断控制器引入机制是为了适应多处理器环境经历了个版本最初的属于外部设备以外部的芯片形式存在在家族和处理器后以形式存在引入了处理器内部的架构和外部相比较功能得到了扩展和增强和处理器在的基础上进一步扩展形成了体系以及最后在基础上再一次扩展的体系每个逻辑处理器都有自己的每个包括了一组寄存器用来控制和中断的产生发送和接收等也产生和发送处理器间的中断消息寄存器组以内存映射形式映射到物理地址空间上因此软件可以使用指令进行访问然而在模式上寄存器映射到寄存器组来代替映射内存软件使用和指令来访问寄存器如下所示这是在支持的系统上两个线程共享一个执行单元每个有自己的这个决定了在上的地址可以用于处理器间的消息接收和发送也可用于外部中断消息的接收标准上两片级联的提供了理论上个中断输入源但实际系统中这些中断源远远不够用从开始微机系统中引入了高级可编程中断控制器兼容新型高级可编程中断控制器是的位升级版本可以用于单和多系统中引入一方面是为了支持多处理器系统需要使外部中断能被有选择地交给某一个来处理利用处理器间中断可以将一个外部中断交给另一个来处理也可以在之间发布消息或者实现抢占式调度多处理器系统中通过彼此发送中断来完成它们之间的通信另一方面扩展了系统可用的中断数达到个分隔了设备使用的中断在系统中只有设备才能使用号中断而设备仍然使用常规的号中断解决了使用中断控制器所带来的中断共享中断优先级不易控制等问题总线工业标准体系结构是为电脑而制定的总线标准为位体系结构只能支持位的设备数据传输率大约是也称为标准是的缩写插槽是基于总线工业标准结构总线的扩展插槽其颜色一般为黑色比接口插槽要长些位于主板的最下端其工作频率为左右为位插槽最大传输率可插接显卡声卡网卡已及所谓的多功能接口卡等扩展插卡其缺点是资源占用太高数据传输带宽太小是已经被淘汰的插槽接口是的系统总线最大传输速率仅为但允许多个共享系统资源由于兼容性好它在上个世纪年代是最广泛采用的系统总线不过它的弱点也是显而易见的比如传输速率过低占用率高占用硬件中断资源等后来在规范中就开始放弃了总线而从芯片组开始也不再提供对接口的支持是一种高速串行计算机扩展总线标准它原来的名称为是由英特尔在年提出的旨在替代旧的和总线标准总线已成为了计算机的一种标准总线总线取代了早先的总线有许多优点比如即插即用中断共享等所谓即插即用是指当板卡插入系统时系统会自动对板卡所需资源进行分配如基地址中断号等并自动寻找相应的驱动程序而不象旧的板卡需要进行复杂的手动配置实际的实现远比说起来要复杂在板卡中有一组寄存器叫配置空间用来存放基地址与内存地址以及中断等信息以内存地址为例当上电时板卡从里读取固定的值放到寄存器中对应内存的地方放置的是需要分配的内存字节数等信息操作系统要根据这个信息分配内存并在分配成功后把相应的寄存器中填入内存的起始地址这样就不必手工设置开关来分配内存或基地址了对于中断的分配也与此类似卡的一个重要局限在于中断是独占的而我们知道计算机的中断号只有个系统又用掉了一些这样当有多块卡要用中断时就会有问题了总线的中断共享由硬件与软件两部分组成硬件上采用电平触发的办法中断信号在系统一侧用电阻接高而要产生中断的板卡上利用三极管的集电极将信号拉低这样不管有几块板产生中断中断信号都是低而只有当所有板卡的中断都得到处理后中断信号才会回复高电平软件上采用中断链的方法假设系统启动时发现板卡用了中断就会将中断对应的内存区指向卡对应的中断服务程序入口然后系统发现板卡也用中断这时就会将中断对应的内存区指向同时将的结束指向以此类推就会形成一个中断链而当有中断发生时系统跳转到中断对应的内存也就是就要检查是不是卡的中断如果是要处理并将板卡上的拉低电路放开如果不是则呼叫这样就完成了中断的共享咱们继续值得注意的是只有以后的操作系统才支持可以支持但需要定制缺省安装并不支持运行于实模式不支持只有在保护模式下才能使用因此整个系统可以分为两大部分和如图所示单核或者多核情况下每个处理器中都有自己的而是作为系统芯片组中一部分在的控制器内系统最多有个通过系统总线接收该处理器产生的本地中断例如时钟中断等及处理器间中断并接收外部的中断消息如来自的消息等负责接收所有外部的硬件中断并翻译成消息选择发给接收中断的处理器功能可以被关闭被关闭时由集成在芯片组内的功能模块来处理中断此时的引脚连接到连接到本节介绍的以和为主采用的有所不同典型地兼容类的中断控制器是在单处理器系统上使用已不能适应于多处理器环境而能适用于多处理器环境上可以发送中断消息到指向的上属于芯片组的一部分现称为位于南桥芯片的控制器上各芯片组厂商的南桥名称都有所不同例如英特尔称之为路径控制器或平台路径控制器因此后面看着叫也不需要奇怪哦也有自己的寄存器同样也以内存映射形式映射到物理地址空间上本地包含了和的功能是一个可编程定时计数器芯片用于处理计算机中的精确时间延迟该芯片提供了个独立的位计数器通道每个通道可工作在不同的工作方式下并且这些工作方式均可以使用软件来设置对于及其兼容微机系统采用的是芯片操作系统只对通道进行了重新设置使得该计数器工作在方式下并且每间隔毫秒发出一个信号以产生中断请求信号这个间隔定时产生的中断请求就是内核工作的脉搏它用于定时切换当前执行的任务和统计每个任务使用的系统资源量时间它能响应以下几种中断系统中断送来的系统中断请求由交给中断请求指定的目标处理器处理本地中断本地产生的系统中断请求计时器性能监控温度传感器错误本地中断只能由该处理从系列处理器开始可以用特殊命令探测的存在如执行以下命令返回值在寄存器中当返回值第位为时表示本地存在否则表示不存在下面简要介绍的相关机制中断发布方式本地的中断发布方式分为静态和动态两种在静态方式下根据重定向表中的信息中断消息无条件地提交给某一个几个或全部在动态方式下中断消息通过判断提交给最低优先权的或焦点已接收或正在处理该中断如果有多个都执行相同优先级的进程则必须采用仲裁技术寄存器在模式专用寄存器中有一个寄存器其索引为通过它来配置和控制本地例如允许禁止本地及设置本地寄存器的基地址寄存器的格式如图所示时启用本地时此为引导处理器时为应用处理器在多系统中只能有一个引导处理器本地寄存器是多个寄指定使用存储器空间默认情况下将的寄存器都映射到了物理地址本地寄存器长度为位位或者位所有地址边界按照字节即位为边界来访问地址映射见表如下局部向量表偏移为的个本地寄存器构成局部向量表分别代表种中断计时器中断温度传感器中断性能监控中断中断中断错误中断中各个寄存器的格式如图所示屏蔽位等于时对应的中断类型被屏蔽触发位等于时边沿触发等于时电平触发远程位等于时本地收到中断请求收到中断结束命令时置为极性位等于时高电平有效等于时低电平有效状态位等于时已经向提交了中断请求但还没有应答一共有种提交模式见表如下当提交模式等于时读取中的低位作为中断向量计时器中断本地中的计时器相关寄存器包括当前计数寄存器计数初值寄存器和除数寄存器给寄存器赋值时初始值装入的值按一定频率递减递减的频率等于系统总线频率除以刻度系数刻度系数由确定的值递减到时向处理器提交计时器中断当计时器采用单次模式循环位等于时提交计时器中断后的值一直保持为直到向寄存器装入新的初值采用循环模式时提交计时器中断后的值重新到继续递减计数过程中若初始计数寄存器被重置了则将使用新的初始计数值重新开始计数发布中断通过写入寄存器可以向自身或者其他发布处理器间中断寄存器为位低位的地址为高位的地址为的主要功能包括发送一个中断给另外一个处理器允许处理器转发它收到的一个中断但不对另一个处理器的请求提供服务把处理器定向到中断本身即执行一次自我中断传送特定的比如启动消息到其他处理器寄存器格式如图所示寄存器中均保留其他位含义如下表示中断向量号表示提交模式固定传送向量域中指定的中断到目标处理器或者处理器组最低优先权除了把中断传送给目的域中指定的目标处理器组中的优先级最低的处理器之外其他同于固定模式处理器传送最低优先权的能力是与模型相关的和操作系统软件应该避免它传送一个中断给目标处理器或者处理器组为了与未来兼容该向量域应该设成保留传送一个中断给目标处理器或者处理器组忽略向量信息传送一个请求给目标处理器或者处理器组使之执行一次初始化作为这个消息的结果之一所有处理器都执行一次初始化未激活的电平发送一个同步消息给系统中的所有本地把它们的仲裁设置成它们的对于这个传送模式电平标志必须设为触发模式标志设为目标指示应为和处理器中不支持用来指定接收目标的模式时使用物理目标模式时使用逻辑目标模式提交状态是只读位等于时表示上一次发送的消息还没有被目标接收有效电平位表示无效电平表示有效电平注意无效电平可能是高电平或者低电平有效电平也可能是高电平或者低电平触发模式位表示边沿触发表示电平触发目标指示位等于时表示根据目标确定发送目标等于时发送给自己等于时发送给所有等于时发送给所有自己除外表示消息的目标地址目标地址的表示方式包括两种物理目标模式和逻辑目标模式下面介绍这两种模式物理目标模式每一个本地都有唯一的在寄存器的第位中指定一个消息将发送给与它相同的另一个当第位为时消息广播给所有的对于和处理器来说一个单个目的本地从到或对所有的广播是都可能在物理模式下指定对于系列和处理器来说一个单个目的是由具有从到的本地的物理目的传送模式指定的允许总线中访问多达个本地对所有本地的广播是由指定的逻辑目标模式使用逻辑目标模式发送时目标可以采用平面模式和集群模式本地中有一个目标格式寄存器如图所示它的高位第位等于时表示平面模式等于时表示集群模式平面模式本地中的逻辑目标寄存器的高位保存的是逻辑标识如图所示将逻辑标识与相与如果得到的结果有任何一位等于那么这个就接收消息在平面模式下由于逻辑标识有个二进制位支持最多个集群模式支持平面集群模式和层次集群模式而只支持层次集群模式在层次集群模式下在的外部还必须设置专门的集群管理设备支持最多个集群每个集群上最多连接个每个集群使用单独的或系统总线例假设三个的模式配置为的值为的值为的值为此时的值为发出一条中断消息其为值为试分析该中断消息由哪些接收解答三个收到该消息后通过的高位判断出该消息目的地为本簇再将自身的低位与低位进行位与操作与结果不为故最终接收该中断消息丢弃处理中断本地接收到系统中断处理器间中断本地中断后按照以下流程进行处理检查系统中断处理器间中断消息中的目标地址与本地是否匹配如果不匹配则忽略此消息检查中断消息中的提交模式如果是或者那么由这个直接处理否则设置寄存器共位中的相应位当有和寄存器中记录了中断请求时按照中断请求的中断向量任务优先权寄存器处理器优先权寄存器进行优先级判断交给某一个处理中断结束提交模式为固定时中断服务程序写的寄存器将中断从寄存器中清除如果是电平触发向系统总线发送一条消息表示中断处理结束提交模式为或者时中断服务程序不需要写入寄存器中断请求寄存器和中断服务寄存器中断请求寄存器共位地址为中断服务寄存器也是位地址为如果中断的提交模式为固定方式中断请求寄存器记录了本地已经接收到的但还没有指派给某一个的中断当可以处理中断时中具有最高优先级的中断即中断向量最大对应的位被置为再将中的对应位置为中具有最高优先级的中断被发送给进行处理在处理高优先级的中断时如果发生了低优先级的中断该中断的位置为在高优先级的中断处理完成后中断服务程序写入寄存器清除高优先级中断的位这时低优先级中断就会被处理在处理某个优先级的中断时如果发生了相同优先级的中断该中断的位置为前一个中断处理完成后后面的中断才会被处理在处理某个优先级的中断时如果发生了更高优先级的中断本地可以向发送中断前一个中断被暂停进入新的中断服务程序这就是中断嵌套触发模式寄存器也是位当中断的位置为时边沿触发中断的位清为电平触发中断的位置为优先权中断优先权由它的中断向量号决定中断优先权等于中断向量号除以即中断向量号的高位范围是注意中断向量号由保留任务优先权寄存器的地址为格式如图所示处理器优先权寄存器的地址为格式如图所示中断优先权大于任务优先权时中断才会被处理通过设置任务优先权寄存器禁止低级别的中断例如把中的第位任务优先权设为时那么所有的外部中断除等都会被屏蔽而任务优先权设为时这些外部中断不被屏蔽处理器优先权寄存器不能被程序所修改是一个只读寄存器它反映了当前正在执行的程序的优先级的值是当前正在服务的中断向量和二者之间较高的值设是中被设置为的最高优先权的中断向量中所有位等于时等于按照以下公式来确定消息信号中断规范中引入了消息信号中断设备可以用两种方法向发出中断请求用设备的一个引脚发送中断请求信号用向处理器传送中断请求采用向发送中断请求时设备发起一个写操作向一个特殊的地址写入一个特定数据地址的格式如图所示数据的格式如图所示在地址中目标指定了消息发送给哪一个组说明是否要把消息发送给一组中具有最低优先权的则指示采用物理目标模式或者逻辑目标模式在数据部分触发模式有边沿触发和电平触发两种后者又分高电平有效和低电平有效提交模式分为固定最低优先级等几种用来替代传统的中断控制器一般集成在芯片组中意思是输入输出控制器中心负责连接总线设备设备等是英特尔的南桥芯片系列名称表中列出了管理下每个中断源对应的中断向量和相比能支持个中断源不需要中断应答周期可以将中断请求发送给某一个指定的的中断优先权由中断向量来确定与中断源无关所以软件编程的时候这个中断向量的设置很需要注意也更加体现了的灵活性系统中最多可以拥有个每一个都分别有自己的输入编码加起来一台上会有上百个可供设备中断使用和共同起作用如果系统中没有那么就没有用处此时操作系统会使用系统中常用芯片来作为寄存器地址系统中默认映射到物理地址一共有个寄存器地址见表一共有个位内部寄存器其索引为内部寄存器索引见表重定向表中断重定向表中的每一项都有可以被单独编程用来指明中断向量和优先级目标处理器及选择处理器的方式重定向表中的信息用于把每个外部信号转换为一条消息然后通过总线把消息发送给一个或者多个本地单元重定向表的格式如图所示目标确定哪一个组处理这个中断目标模式等于时即物理目标模式目标的第位表示某一个的等于时即逻辑目标模式目标的第位与中的逻辑标识匹配确定目标向发送中断时扩展目标位被放置在地址的第位地址格式如上图所示屏蔽位等于时这个中断不会向发送触发模式分为边沿触发和电平触发两种后者又分高电平有效和低电平有效在电平触发时远程位有效等于时表示的本地已接受此中断收到本地发送的后将此位清相对于本地和核心而言和本地之间的传递是远程的提交状态等于时表示中断消息已产生但还没有发送给本地提交模式分为固定最低优先级等几种最低优先级表示把这个中断按照目标提交给最低的重定向表的第位表示该中断对应的中断向量号在表中列出了某系统中各个对应的中断向量号以上就是对的中断有了一个简单的了解后续我们接着来看看的这个名称的由来是由于绘制架构图时所派生出来的称呼第一次被提到这名词时是在年采用架构时在规格的创始者视总线为整个平台架构的正中央北桥芯片将总线主干延伸至北边以支持存储器或缓存以及其他攸关性能的功能反之南桥芯片将总线主干延伸至南边并桥接起比较非攸关性能的功能例如磁盘接口等音效等位于架构图的正北方它透过较高速的北桥芯片链接北边的系统设备而北桥则透过较慢速的南桥芯片连接南边的其他系统设备虽然现今平台架构已将总线主干取代换上更快的主干但桥的传统名称仍然延续使用北桥英语是基于处理器的个人电脑主板芯片组两枚芯片中的一枚北桥用来处理高速信号例如中央处理器存储器显卡接口或接口还有与南桥之间的通信北桥芯片位置刚好跟南桥芯片位置相反它是靠近部分被散热片覆盖的大的那块芯片主要功能是负责控制连接和处理与内存与南桥通信北桥芯片是主板的关键芯片负责管理二级高速缓存内存的类型和最大容量都由它决定所以一般主板命名都是用北桥芯片的型号有一些北桥会集成内置显示核心如也支持或接口集成显示核心的北桥若侦测到已安装的显卡会停止其功能但有些北桥可以允许同时使用集成式显卡和安装外加显卡作为多显示输出英特尔在第一代中把存储器控制器集成到了北桥的功能只剩下连接高速设备如显卡此时的南桥称为从开始处理器集成了北桥存储器控制器高速控制器和主板上只剩下南桥将其称为平台路径控制器与全称是高级可编程中断控制器它是在奔腾之后被引入进来的在现在的计算机它通常由两个部分组成分别为本地高级可编程中断控制器和高级可编程中断控制器在中通常位于南桥是在的基础上发展而来的在传统的单处理器的兼容的机器通常使用双片级联组成中断控制器如下图所示一共可以连接个设备有一个管脚被用于串联另一片的优先级规则比较简单号管脚的优先级最高可以通过编程设置起始的号在单个的环境下工作的挺好可是当系统越来越复杂出现了多个的情况它就没法很好的工作了这种情况下所有的中断都会丢给主连接的那个那么这个就要处理所有的中断性能上就会有影响在一个多处理器的系统任何一个都应该能够响应来自任何设备的中断这种就是所谓的对称式多重处理的主要作用是中断的分发最初有一条专门的总线用于和通信在和系列出现后他们的通信被合并到系统总线中虚拟接线模式该模式主要是为了向前兼容可以理解为就是在这种模式下会把的模拟硬件产生的中断信号直接送给如上图所示每个中都有一个相比较于会更复杂一些它不仅能够处理来自的中断消息它还可以处理和消息默认使用基地址开始的空间用来访问内部寄存器从开始引入一个的可以用来设置基地址在任何对齐的内存地址空间已经收到中断但是还未提交处理已经开始处理中断但是尚未完成中断的触发模式软件写入表示中断处理完成小结到这里我们就对系列的中断有了一个简单的了解后续我们会继续看一下的中断各位周末愉快参考资料在这里感谢前辈老师们的优秀书籍与文章以及丰富的互联网资料计算机硬件技术基础汇编语言与接口技术体系探索及编程如有遗漏请联系补充',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-13 15:48:29',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">远辰</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DPDK/" style="font-size: 1.05rem;">DPDK<sup>3</sup></a><a href="/tags/ONOS/" style="font-size: 1.05rem;">ONOS<sup>1</sup></a><a href="/tags/algorithm/" style="font-size: 1.05rem;">algorithm<sup>1</sup></a><a href="/tags/blockchain/" style="font-size: 1.05rem;">blockchain<sup>1</sup></a><a href="/tags/c/" style="font-size: 1.05rem;">c<sup>1</sup></a><a href="/tags/configuration/" style="font-size: 1.05rem;">configuration<sup>1</sup></a><a href="/tags/container/" style="font-size: 1.05rem;">container<sup>25</sup></a><a href="/tags/go/" style="font-size: 1.05rem;">go<sup>14</sup></a><a href="/tags/kidgets/" style="font-size: 1.05rem;">kidgets<sup>3</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>40</sup></a><a href="/tags/network/" style="font-size: 1.05rem;">network<sup>8</sup></a><a href="/tags/rust/" style="font-size: 1.05rem;">rust<sup>6</sup></a><a href="/tags/sdn/" style="font-size: 1.05rem;">sdn<sup>4</sup></a><a href="/tags/systemtap/" style="font-size: 1.05rem;">systemtap<sup>4</sup></a><a href="/tags/tools/" style="font-size: 1.05rem;">tools<sup>1</sup></a><a href="/tags/tvbox/" style="font-size: 1.05rem;">tvbox<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">December 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">July 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">June 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-08-13T07:48:29.025Z" title="发表于 2024-08-13 15:48:29">2024-08-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-13T07:48:29.025Z" title="更新于 2024-08-13 15:48:29">2024-08-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/"><header><h1 id="CrawlerTitle" itemprop="name headline">无题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">哪吒藕霸</span><time itemprop="dateCreated datePublished" datetime="2024-08-13T07:48:29.025Z" title="发表于 2024-08-13 15:48:29">2024-08-13</time><time itemprop="dateCreated datePublished" datetime="2024-08-13T07:48:29.025Z" title="更新于 2024-08-13 15:48:29">2024-08-13</time></header><blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45264425/article/details/131734426">blog.csdn.net</a></p>
</blockquote>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>前面我们学习了 8259A，但 8259A 只适合单 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=CPU&spm=1001.2101.3001.7020">CPU</a> 的情况，为了充分挖掘 SMP 体系结构的并行性，能够把中断传递给系统中的每个 CPU 至关重要。基于此理由，Intel 引入了一种名为 I&#x2F;O 高级可编程控制器的新组件，来替代老式的 8259A 可编程中断控制器。<br>下面一起来学习一下 APIC。</p>
<h3 id="0-APIC-概述"><a href="#0-APIC-概述" class="headerlink" title="0 APIC 概述"></a>0 APIC 概述</h3><p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Intel&spm=1001.2101.3001.7020">Intel</a> 从 Pentium 处理器开始引入了 APIC（Advanced Programmable Interrupt Controller）机制，直译为高级可编程中断控制器。引入 APIC 机制是为了适应 multiple processor（MP，多处理器）环境。</p>
<p>APIC 经历了 4 个版本</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3a95c2420bb2c8c066fddde41255fa16.png"></p>
<p>最初的 APIC 属于外部设备，以外部的 82489DX 芯片形式存在。在 P6 家族和 Pentium 处理器后，以 APIC on Chip 形式存在，引入了处理器内部的 local APIC 架构，和 82489DX 外部 APIC 相比较功能得到了扩展和增强。</p>
<p>Pentium 4 和 Intel Xeon 处理器在 APIC 的基础上进一步扩展，形成了 xAPIC 体系，以及最后在 xAPIC 基础上再一次扩展的 x2APIC 体系。</p>
<h3 id="1-APIC"><a href="#1-APIC" class="headerlink" title="1 APIC"></a>1 APIC</h3><p>每个 logical processor（逻辑处理器）都有自己的 local APIC，每个 local APIC 包括了一组 local APIC 寄存器，用来控制 local 和 external 中断的产生、发送和接收等，也产生和发送 IPI（处理器间的中断消息）。<strong>local APIC 寄存器组以内存映射形式映射到物理地址空间上，因此软件可以使用 MOV 指令进行访问。</strong></p>
<p>然而在 x2APIC 模式上 local APIC 寄存器映射到 MSR 寄存器组来代替映射内存，软件使用 RDMSR 和 WRMSR 指令来访问 local APIC 寄存器。</p>
<p>如下所示，这是在支持 Intel Hyper-Threading Technology 的 MP 系统上，两个 logical processor（线程）共享一个 processor core 执行单元。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/47d7f4cb9dba47bc8837de0780253f3f.png"><br>每个 local APIC 有自己的 local APIC ID，这个 ID 决定了 logical processor 在 system bus 上的地址，可以用于处理器间的消息接收和发送，也可用于外部中断消息的接收。</p>
<p>标准 PC 上两片级联的 8259 提供了理论上 15 个中断输入源，但实际系统中这些中断源远远不够用。</p>
<p>从 Pentium 开始，微机系统中引入了高级可编程中断控制器 APIC（Advanced Programmable Interrupt Controller）, APIC 兼容 PIC（Programmable Interrupt Controller）。</p>
<p>新型高级可编程中断控制器 SAPIC（StreamLined Advanced Programmable Interrupt Controller）是 APIC 的 64 位升级版本。</p>
<p>APIC 可以用于单 CPU 和多 CPU 系统中。<strong>引入 APIC 一方面是为了支持多处理器系统需要</strong>，使外部中断能被有选择地交给某一个 CPU 来处理。</p>
<p><strong>CPU 利用处理器间中断 IPI （Inter-Processor Interrupt），可以将一个外部中断交给另一个 CPU 来处理</strong>，也可以在 CPU 之间发布消息，或者实现抢占式调度。</p>
<p>多处理器系统中，CPU 通过彼此发送中断来完成它们之间的通信。另一方面，扩展了系统可用的中断数达到 24 个，分隔了 PCI&#x2F;ISA 设备使用的中断，在 APIC 系统中只有 PCI 设备才能使用 16～23 号中断，而 ISA 设备仍然使用常规的 0～15 号中断，解决了使用 8259 中断控制器所带来的中断共享、中断优先级不易控制等问题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ISA总线： (Industry Standard Architecture:工业标准体系结构）是为PC/AT电脑而制定的总线标准，为16位体系结构，只能支持16位的I/O设备，数据传输率大约是16MB/S。也称为AT标准。</span><br><span class="line"></span><br><span class="line">ISA是IndustryStandardArchitecture的缩写ISA插槽是基于ISA总线（IndustrialStandardArchitecture，工业标准结构总线）的扩展插槽，其颜色一般为黑色，比PCI接口插槽要长些，位于主板的最下端。其工作频率为8MHz左右，为16位插槽，最大传输率16MB/sec，可插接显卡，声卡，网卡已及所谓的多功能接口卡等扩展插卡。其缺点是CPU资源占用太高，数据传输带宽太小，是已经被淘汰的插槽接口。</span><br><span class="line"></span><br><span class="line">ISA是8/16bit的系统总线，最大传输速率仅为8MB/s，但允许多个CPU共享系统资源。由于兼容性好，它在上个世纪80年代是最广泛采用的系统总线，不过它的弱点也是显而易见的，比如传输速率过低、CPU占用率高、占用硬件中断资源等。后来在PC‘98规范中，就开始放弃了ISA总线，而Intel从i810芯片组开始，也不再提供对ISA接口的支持。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PCI-Express(peripheral component interconnect express)是一种高速串行计算机扩展总线标准，它原来的名称为“3GIO”，是由英特尔在2001年提出的，旨在替代旧的PCI，PCI-X和AGP总线标准。</span><br><span class="line"></span><br><span class="line">PCI总线已成为了计算机的一种标准总线。 PCI总线取代了早先的ISA总线。</span><br><span class="line"></span><br><span class="line">有许多优点，比如即插即用(Plug and Play)、中断共享等。</span><br><span class="line"></span><br><span class="line">所谓即插即用，是指当板卡插入系统时，系统会自动对板卡所需资源进行分配，如基地址、中断号等，并自动寻找相应的驱动程序。而不象旧的ISA板卡，需要进行复杂的手动配置。</span><br><span class="line">实际的实现远比说起来要复杂。在PCI板卡中，有一组寄存器，叫&quot;配置空间&quot;(Configuration Space)，用来存放基地址与内存地址，以及中断等信息。</span><br><span class="line"></span><br><span class="line">以内存地址为例。当上电时，板卡从ROM里读取固定的值放到寄存器中，对应内存的地方放置的是需要分配的内存字节数等信息。操作系统要根据这个信息分配内存，并在分配成功后把相应的寄存器中填入内存的起始地址。这样就不必手工设置开关来分配内存或基地址了。对于中断的分配也与此类似。</span><br><span class="line"></span><br><span class="line">ISA卡的一个重要局限在于中断是独占的，而我们知道计算机的中断号只有16个，系统又用掉了一些，这样当有多块ISA卡要用中断时就会有问题了。</span><br><span class="line"></span><br><span class="line">PCI总线的中断共享由硬件与软件两部分组成。</span><br><span class="line"></span><br><span class="line">硬件上，采用电平触发的办法：中断信号在系统一侧用电阻接高，而要产生中断的板卡上利用三极管的集电极将信号拉低。这样不管有几块板产生中断，中断信号都是低；而只有当所有板卡的中断都得到处理后，中断信号才会回复高电平。</span><br><span class="line"></span><br><span class="line">软件上，采用中断链的方法：假设系统启动时，发现板卡A用了中断7，就会将中断7对应的内存区指向A卡对应的中断服务程序入口ISR_A；然后系统发现板卡B也用中断7，这时就会将中断7对应的内存区指向ISR_B，同时将ISR_B的结束指向ISR_A。以此类推，就会形成一个中断链。</span><br><span class="line">而当有中断发生时，系统跳转到中断7对应的内存，也就是ISR_B。ISR_B就要检查是不是B卡的中断，如果是，要处理，并将板卡上的拉低电路放开；如果不是，则呼叫ISR_A。这样就完成了中断的共享。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">咱们继续</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>值得注意的是，只有 Windows 2000 以后的操作系统才支持 APIC, Linux 可以支持但需要定制，缺省安装并不支持。</p>
<p><strong>BIOS 运行于实模式，不支持 APIC, APIC 只有在保护模式下才能使用。</strong>（因此 8259A）</p>
<p>整个 APIC 系统可以分为两大部分：LAPIC（Local APIC）和 IO APIC，如图 23 所示。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/4bfc38381deedd08962261752a5429e9.png"><br>单核或者多核情况下，每个处理器中都有自己的 LAPIC，而 IO APIC 是作为系统芯片组中一部分，在 PCI-to-ISA bridge 的 LPC 控制器内，系统最多有 8 个 IO APIC。</p>
<p>LAPIC 通过系统总线接收该处理器产生的本地中断（例如时钟中断等）及处理器间中断，并接收外部的中断消息，如来自 IO APIC 的消息等。</p>
<p>IO APIC 负责接收所有外部的硬件中断，并翻译成消息选择发给接收中断的处理器。</p>
<p>APIC 功能可以被关闭。<strong>APIC 被关闭时，由集成在芯片组内的 8259 功能模块来处理中断</strong>，<strong>此时 LAPIC 的引脚 LINT0 连接到 INTR, LINT1 连接到 NMI</strong>。本节介绍的 APIC 以 Pentium 4 和 Xeon 为主，Pentium 采用的 APIC 有所不同。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/4b38d2fab8d04a049344b7dd30bd4190.png"></p>
<h3 id="2-LAPIC"><a href="#2-LAPIC" class="headerlink" title="2 LAPIC"></a>2 LAPIC</h3><p>典型地，8259 兼容类的 legacy 中断控制器是在 uni-processor（单处理器）系统上使用，已不能适应于多处理器环境，而 I&#x2F;O APIC 能适用于 multi-porcessor（多处理器）环境上。</p>
<p>I&#x2F;O APIC 可以发送中断消息到指向的 logical processor 上。I&#x2F;O APIC 属于芯片组的一部分，现称为 PCH（Platform controller Hub），位于 PCIto-ISA bridge（南桥芯片）的 LPC 控制器上。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">各芯片组厂商的南桥名称都有所不同,例如英特尔称之为I/O路径控制器(ICH,IO Controller Hub)或平台路径控制器(PCH)。</span><br><span class="line"></span><br><span class="line">因此后面看着叫PCH也不需要奇怪哦！！！</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>I&#x2F;O APIC 也有自己的寄存器，同样也以内存映射形式映射到物理地址空间上。</p>
<p>LAPIC（Local APIC，本地 APIC）包含了 8259 和 8254 的功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intel 8253/8254是一个可编程定时/计数器（PIT-Programmable Interval Timer)芯片，用于处理计算机中的精确时间延迟。该芯片提供了 3个独立的16位计数器通道。每个通道可工作在不同的工作方式下， 并且这些工作方式均可以使用软件来设置。</span><br><span class="line"></span><br><span class="line">对于PC/AT及其兼容微机系统采用的是8254芯片。Linux 0.11操作系统只对通道0进行了重新设置，使得该计数器工作在方式3下，并且每间隔10毫秒发出一个信号以产生中断请求信号（IRQ0)。这个间隔定时产生的中断请求就是Linux 0.11内核工作的脉搏，它用于定时切换当前执行的任务和统计每个任务使用的系统资源量（时间）。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>它能响应以下几种中断：</p>
<ul>
<li>① 系统中断：IO APIC 送来的系统中断请求，由 IO APIC 交给中断请求指定的目标处理器处理。</li>
<li>③ 本地中断：本地 APIC 产生的系统中断请求（计时器、LINT0&#x2F;LINT1、性能监控、温度传感器、错误）。本地中断只能由该 CPU 处理。</li>
</ul>
<p>从 P6 系列处理器开始，可以用特殊命令 CPUID 探测 LAPIC 的存在。如执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MOV   EAX, 1</span><br><span class="line">CPUID</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>返回值在 EDX 寄存器中，当返回值第 9 位为 1 时，表示本地 APIC 存在，否则表示不存在。</p>
<p>下面简要介绍 LAPIC 的相关机制。</p>
<ul>
<li>（1）中断发布方式</li>
</ul>
<p>本地 APIC 的中断发布方式分为静态和动态两种。</p>
<p>在静态方式下，根据重定向表中的信息，中断消息无条件地提交给某一个、几个或全部 CPU；</p>
<p>在动态方式下，中断消息通过 TPR （Task Priority Register）判断提交给最低优先权的 CPU 或焦点 CPU（已接收或正在处理该中断）。</p>
<p>如果有多个 CPU 都执行相同优先级的进程，则必须采用仲裁（Arbitration）技术。</p>
<ul>
<li>（2）IA32_APIC_BASE 寄存器<br>在模式专用寄存器（Model Specific Register）中，有一个 IA32_APIC_BASE 寄存器，其索引为 1BH。CPU 通过它来配置和控制本地 APIC，例如允许、禁止本地 APIC 及设置本地 APIC 寄存器的基地址。IA32_APIC_BASE 寄存器的格式如图 24 所示。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/a13c2cc7f07086243e88dc12ca519281.png"></p>
<ul>
<li>E&#x3D;1 时，启用本地 APIC。</li>
<li>BSP&#x3D;1 时，此 CPU 为引导处理器；</li>
<li>BSP&#x3D;0 时，为应用处理器。</li>
</ul>
<p><strong>在多 CPU 系统中，只能有一个引导处理器。</strong></p>
<p>本地 APIC 寄存器是多个寄 32_APIC_BASE 指定，使用 4KB 存储器空间。</p>
<p><strong>默认情况下，Intel 将 LAPIC 的寄存器都映射到了物理地址 0xFEE00000H。</strong></p>
<p>本地 APIC 寄存器长度为 32 位、64 位或者 256 位，所有地址边界按照 16 字节即 128 位为边界来访问。APIC 地址映射见表如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/341cf4b47e4e24e5eb7c2167a73f25c8.png"></p>
<ul>
<li>（3）局部向量表</li>
</ul>
<p><strong>偏移为 320H～370H 的 6 个本地 APIC 寄存器构成局部向量表 LVT（Local Vector Table）</strong>，分别代表 6 种中断：</p>
<ul>
<li>计时器中断、</li>
<li>温度传感器中断、</li>
<li>性能监控中断、</li>
<li>LINT0 中断、</li>
<li>LINT1 中断</li>
<li>错误中断。</li>
</ul>
<p>LVT 中各个寄存器的格式如图 25 所示。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3037e10e740944146c172a26f03b8f86.png"></p>
<ul>
<li>① D16 屏蔽位等于 1 时，对应的中断类型被屏蔽。</li>
<li>② D15 触发位等于 0 时，边沿触发；等于 1 时，电平触发。</li>
<li>③ D14 远程位等于 1 时，本地 APIC 收到中断请求。收到中断结束命令时，置为 0。</li>
<li>④ D13 极性位等于 0 时，LINT0&#x2F;LINT1 高电平有效；等于 1 时，低电平有效。</li>
<li>⑤ D12 状态位等于 1 时，已经向 CPU 提交了中断请求，但 CPU 还没有应答。</li>
</ul>
<p>一共有 5 种提交模式，见表如下。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/476860db5370376111801dd267ea1355.png"><br>当提交模式等于 000B 时，CPU 读取 LVT 中的低 8 位作为中断向量。</p>
<ul>
<li>（4）计时器中断</li>
</ul>
<p><strong>本地 APIC 中的计时器相关寄存器包括当前计数寄存器 CCR、计数初值寄存器 CR 和除数寄存器 DCR。</strong></p>
<p>给 CR 寄存器赋值时，初始值装入 CCR, CCR 的值按一定频率递减，递减的频率等于系统总线频率除以刻度系数。刻度系数由 DCR 确定。CCR 的值递减到 0 时，向处理器提交计时器中断。</p>
<p><strong>当计时器采用单次模式（循环位等于 0）时</strong>，提交计时器中断后，CCR 的值一直保持为 0，直到向 CR 寄存器装入新的初值。采用循环模式时，提交计时器中断后，CR 的值重新到 CCR，继续递减。计数过程中若初始计数寄存器被重置了，则将使用新的初始计数值，重新开始计数。</p>
<ul>
<li>（5）发布中断</li>
</ul>
<p>通过写入 ICR 寄存器，CPU 可以向自身或者其他 CPU 发布处理器间中断 IPI。ICR 寄存器为 64 位，低 32 位的地址为 FEE00300H，高 32 位的地址为 FEE00310H。</p>
<p><strong>ICR 的主要功能包括：发送一个中断给另外一个处理器；允许处理器转发它收到的一个中断，但不对另一个处理器的请求提供服务</strong>；把处理器定向到中断本身，即执行一次自我中断；传送特定的 IPI，比如启动 IPI（SIPI）消息，到其他处理器。</p>
<p>ICR 寄存器格式如图 26 所示。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/c40bff9e3494ab3ed976e4ed1e95b021.png"><br>ICR 寄存器中，D13、D16、D17、D20～D55 均保留。其他位含义如下：</p>
<ul>
<li><p>① D7～D0 表示中断向量号。</p>
</li>
<li><p>② D10～D8 表示提交模式：</p>
<ul>
<li>a. 000（固定）：传送向量域中指定的中断到目标处理器或者处理器组。</li>
<li>b. 001（最低优先权）：除了把中断传送给目的域中指定的目标处理器组中的优先级最低的处理器之外，其他同于固定模式。处理器传送最低优先权 IPI 的能力是与模型相关的，BIOS 和操作系统软件应该避免它。</li>
<li>c. 010（SMI）：传送一个 SMI 中断给目标处理器或者处理器组。为了与未来兼容，该向量域应该设成 00H。</li>
<li>d. 011（保留）。e. 100（NMI）：传送一个 NMI 中断给目标处理器或者处理器组。忽略向量信息。</li>
<li>f. 101（INIT）：传送一个 INIT 请求给目标处理器或者处理器组，使之执行一次初始化。作为这个 IPI 消息的结果之一，所有处理器都执行一次初始化。</li>
<li>g. 110（未激活 INIT 的电平）：发送一个同步消息给系统中的所有本地 APIC，把它们的仲裁 ID 设置成它们的 APIC ID。对于这个传送模式，电平标志必须设为 0，触发模式标志设为 1，目标指示应为 10（Pentium 4 和 Intel Xeon 处理器中不支持）。</li>
</ul>
</li>
<li><p>③ D11 用来指定接收目标的模式。D11&#x3D;0 时，使用物理目标模式；D11&#x3D;1 时，使用逻辑目标模式。</p>
</li>
<li><p>④ D12 提交状态是只读位。等于 1 时，表示上一次发送的 IPI 消息还没有被目标 CPU 接收。</p>
</li>
<li><p>⑤ D14 有效电平位。0 表示无效电平；1 表示有效电平。注意，无效电平可能是高电平或者低电平，有效电平也可能是高电平或者低电平。</p>
</li>
<li><p>⑥ D15 触发模式位。0 表示边沿触发；1 表示电平触发。</p>
</li>
<li><p>⑦ D19～D18 目标指示位。等于 00 时，表示根据目标 ID 确定发送目标；等于 01 时，发送给自己；等于 10 时，发送给所有 CPU；等于 11 时，发送给所有 CPU（自己除外）。</p>
</li>
<li><p>⑧ D64～D56 表示消息的目标地址（Message Destination Address, MDA）。<strong>目标地址的表示方式包括两种：物理目标模式和逻辑目标模式。</strong><br>下面介绍这两种模式。</p>
<ul>
<li><p>a．物理目标模式。每一个本地 APIC 都有唯一的 APIC ID。在 ICR 寄存器的第 63～56 位中指定一个 APIC ID，消息将发送给与它相同的另一个 APIC。</p>
<ul>
<li>当第 63～56 位为 FFH 时，消息广播给所有的 APIC。</li>
<li>对于 Pentium 4 和 Intel Xeon 处理器来说，一个单个目的（本地 APIC ID 从 00H 到 FEH）或对所有 APIC 的广播（APIC ID 是 FFH）都可能在物理模式下指定。</li>
<li>对于 P6 系列和 Pentium 处理器来说，一个单个目的是由具有从 0H 到 0EH 的本地 APIC ID 的物理目的传送模式指定的，允许 APIC 总线中访问多达 15 个本地 APIC。对所有本地 APIC 的广播，是由 0FH 指定的。</li>
</ul>
</li>
<li><p>b．逻辑目标模式。使用逻辑目标模式发送 IPI 时，目标 APIC 可以采用平面模式和集群模式。<br>本地 APIC 中有一个目标格式寄存器（Destination Format Register, DFR），如图 27 所示，它的高 4 位（第 31～28 位）等于 1111B 时，表示平面模式；等于 0000B 时，表示集群模式。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3c60d85f33dc0ec417847d888f64e63b.png"></p>
<ul>
<li><p>平面模式：本地 APIC 中的逻辑目标寄存器（Logic Destination Register, LDR）的高 8 位保存的是逻辑 APIC 标识，如图 28 所示。<br>将逻辑 APIC 标识与 MDA 相与，如果得到的结果有任何一位等于 1，那么这个 APIC 就接收 IPI 消息。在平面模式下，由于逻辑 APIC 标识有 8 个二进制位，支持最多 8 个 CPU。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/9e7d86c624871fdaf0e238159cdda1f4.png"></p>
</li>
<li><p>集群模式：Pentium CPU 支持平面集群模式和层次集群模式，而 Pentium 4 只支持层次集群模式。在层次集群模式下，在 CPU 的外部还必须设置专门的集群管理设备，支持最多 15 个集群，每个集群上最多连接 4 个 APIC，每个集群使用单独的 APIC 或系统总线。</p>
<p>例 9.14 假设三个 CPU 的 logical 模式配置为：CPU 1 的 LDR 值为 00000001b, CPU 2 的 LDR 值为 00010010b, CPU3 的 LDR 值为 00000100b，此时 DFR 的 model 值为 0000b。IO APIC 发出一条中断消息，其 Destination Mode 为 1, Destination field 值为 00000001b。试分析该中断消息由哪些 CPU 接收。<br>解答：三个 LAPIC 收到该消息后，CPU1、CPU3 通过 Destination field 的高 4 位判断出该消息目的地为本簇，再将自身 Logical APIC ID 的低 4 位与 Destination field 低 4 位进行位与操作，CPU1 与结果不为 0，故最终 CPU1 接收该中断消息，CPU2、CPU3 丢弃。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>（6）处理中断<br>本地 APIC 接收到系统中断、处理器间中断、本地中断后，按照以下流程进行处理：</p>
</li>
<li><p>① 检查系统中断、处理器间中断消息中的目标地址与本地 APIC 是否匹配，如果不匹配，则忽略此消息。</p>
</li>
<li><p>② 检查中断消息中的提交模式，如果是 NMI、SMI、INIT、ExtINT 或者 SIPI，那么由这个 CPU 直接处理；否则设置 IRR 寄存器（共 256 位）中的相应位。</p>
</li>
<li><p>③ 当有 IRR 和 ISR 寄存器中记录了中断请求时，按照中断请求的中断向量、任务优先权寄存器 TPR、处理器优先权寄存器 PPR 进行优先级判断，交给某一个 CPU 处理。</p>
</li>
<li><p>④ 中断结束。提交模式为固定时，中断服务程序写 LAPIC 的 EOI 寄存器，将中断从 ISR 寄存器中清除，如果是电平触发，LAPIC 向系统总线发送一条消息，表示中断处理结束。提交模式为 NMI、SMI、INIT、ExtINT 或者 SIPI 时，中断服务程序不需要写入 EOI 寄存器。</p>
</li>
<li><p>（7）中断请求寄存器 IRR 和中断服务寄存器 ISR</p>
</li>
</ul>
<p>中断请求寄存器 IRR 共 256 位，地址为 FEE00200H～FEE00270H；中断服务寄存器 ISR 也是 256 位，地址为 FEE00100H～FEE00170H。</p>
<p>如果中断的提交模式为固定方式，中断请求寄存器 IRR 记录了本地 APIC 已经接收到的，但还没有指派给某一个 CPU 的中断。当 CPU 可以处理中断时，IRR 中具有最高优先级的中断（即中断向量最大）对应的位被置为 0，再将 ISR 中的对应位置为 1。ISR 中具有最高优先级的中断被发送给 CPU 进行处理。</p>
<p>在处理高优先级的中断时，如果发生了低优先级的中断，该中断的 IRR 位置为 1。在高优先级的中断处理完成后，中断服务程序写入 EOI 寄存器，清除高优先级中断的 ISR 位。这时低优先级中断就会被处理。在处理某个优先级的中断时，如果发生了相同优先级的中断，该中断的 IRR 位置为 1。前一个中断处理完成后，后面的中断才会被处理。在处理某个优先级的中断时，如果发生了更高优先级的中断，本地 APIC 可以向 CPU 发送中断，前一个中断被暂停，进入新的中断服务程序。这就是中断嵌套。</p>
<p>触发模式寄存器 TMR 也是 256 位。当中断的 IRR 位置为 1 时，边沿触发中断的 TMR 位清为 0，电平触发中断的 TMR 位置为 1。</p>
<ul>
<li>（8）优先权<br>中断优先权由它的中断向量号决定，中断优先权等于中断向量号除以 16，即中断向量号的高 4 位，范围是 2～15。注意，中断向量号 0～31 由 CPU 保留。</li>
</ul>
<p>任务优先权寄存器 TPR 的地址为 FEE00080H，格式如图 29 所示。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/85e2f94042d59f0f8a7ce25ed0eaefa8.png"></p>
<p>处理器优先权寄存器 PPR 的地址为 FEE000A0H，格式如图 30 所示。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/7993e044d18f5445b745d11132f39649.png"><br>中断优先权大于任务优先权时，中断才会被处理。</p>
<p>CPU 通过设置任务优先权寄存器 TPR，禁止低级别的中断。例如，把 TPR 中的第 7～4 位（任务优先权）设为 15 时，那么所有的外部中断（除 NMI、SMI、INIT、ExtINT 等）都会被屏蔽。而任务优先权设为 0 时，这些外部中断不被屏蔽。</p>
<p>** 处理器优先权寄存器不能被程序所修改，是一个只读寄存器。** 它反映了当前 CPU 正在执行的程序的优先级。PPR 的值是当前正在服务的中断向量和 TPR 二者之间较高的值。</p>
<p>设 ISRV 是 ISR 中被设置为 1 的最高优先权的中断向量，ISR 中所有位等于 0 时，ISRV 等于 0。PPR 按照以下公式来确定：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">IF  TPR[7∶∶4] ≥ ISRV[7∶∶4]</span><br><span class="line">THEN</span><br><span class="line">        PPR[7∶∶0]=TPR[7∶∶0]</span><br><span class="line">ELSE</span><br><span class="line">        PPR[7∶∶4]=ISRV[7∶∶4]; PPR[3∶∶0]=0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>（9）消息信号中断</li>
</ul>
<p>PCI 2.2 规范中引入了消息信号中断 MSI（Message Signaled Interrupts）。PCI 设备可以用两种方法向 CPU 发出中断请求：</p>
<ul>
<li>①用设备的一个引脚发送中断请求信号；</li>
<li>②用 MSI 向处理器传送中断请求。</li>
</ul>
<p>采用 MSI 向 CPU 发送中断请求时，PCI 设备发起一个 PCI 写操作，向一个特殊的地址写入一个特定数据。地址的格式如图 9-31 所示，数据的格式如图 32 所示。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/23cea9a8b4cd1b63725647487d22dbc9.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/5eed0fad214fbee3d94a4f5d64956b4b.png"></p>
<p>在地址中，目标 ID 指定了 MSI 消息发送给哪一个（组）CPU, RH 说明是否要把消息发送给一组中具有最低优先权的 CPU, DM 则指示采用物理目标模式或者逻辑目标模式。</p>
<p>在数据部分，触发模式有边沿触发和电平触发两种，后者又分高电平有效和低电平有效。提交模式分为固定、最低优先级、SMI、NMI、INIT、ExtINT 等几种。</p>
<h3 id="3-IO-APIC"><a href="#3-IO-APIC" class="headerlink" title="3 IO APIC"></a>3 IO APIC</h3><p><strong>IO APIC 用来替代传统的 8259 中断控制器，一般集成在 ICH 芯片组中。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ICH（I/O controller hub意思是“输入/输出控制器中心”，负责连接PCI总线，IDE设备，I/O设备等，是英特尔的南桥芯片系列名称。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>表 7 中列出了 IO APIC 管理下每个中断源对应的中断向量。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/97234603e1c99bc4c86fb5ba608b7355.png"></p>
<p>和 8259 相比，IO APIC 能支持 24 个中断源，不需要中断应答周期，可以将中断请求发送给某一个指定的 CPU。</p>
<p><strong>IO APIC 的中断优先权由中断向量来确定，与中断源（IRQ）无关。</strong>(所以软件编程的时候这个中断向量的设置很需要注意，也更加体现了 APIC 的灵活性)</p>
<p>系统中最多可以拥有 8 个 IO APIC，每一个 IO APIC 都分别有自己的输入编码，加起来一台 PC 上会有上百个 IRQ 可供设备中断使用。</p>
<p>IO APIC 和 LAPIC 共同起作用，如果系统中没有 IO APIC，那么 LAPIC 就没有用处，此时操作系统会使用 8259。<strong>Intel 系统中常用 82093AA 芯片来作为 IO APIC。</strong></p>
<ul>
<li>（1）IO APIC 寄存器地址<br>Intel 系统中，IO APIC 默认映射到物理地址 FEC00000H。IO APIC 一共有 4 个寄存器地址，见表 8。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/b3410b66e9f3d6bae7c53aa3497e3902.png"><br>一共有 64 个 32 位内部寄存器，其索引为 0～63。内部寄存器索引见表 9。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/d07b1773706b17c3778d0bfb8d49cd2b.png"></p>
<ul>
<li>（2）重定向表</li>
</ul>
<p>中断重定向表中的每一项都有可以被单独编程，用来指明中断向量和优先级、目标处理器及选择处理器的方式。</p>
<p>重定向表中的信息用于把每个外部 IRQ 信号转换为一条消息，然后通过 APIC 总线把消息发送给一个或者多个本地 APIC 单元。</p>
<p>重定向表的格式如图 33 所示。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/f7ee582a8d68d6af7cffd4f5cf2fca00.png"><br>目标 ID 确定哪一个（组）CPU 处理这个中断。目标模式等于 0 时，即物理目标模式，目标 ID 的第 59～56 位表示某一个 CPU 的 APIC ID；等于 1 时，即逻辑目标模式，目标 ID 的第 53～56 位与 CPU 中的逻辑 APIC 标识匹配，确定目标。</p>
<p>向 CPU 发送中断时，扩展目标 ID（8 位）被放置在地址的第 11～4 位。地址格式如上图所示。</p>
<p>屏蔽位等于 1 时，这个中断不会向 CPU 发送。触发模式分为边沿触发（D15&#x3D;0）和电平触发（D15&#x3D;1）两种，后者又分高电平有效（D13&#x3D;0）和低电平有效（D13&#x3D;1）。</p>
<p>在电平触发时，远程 IRR 位有效。等于 1 时，表示 CPU 的本地 APIC 已接受此中断，收到本地 APIC 发送的 EOI 后，将此位清 0。相对于本地 APIC 和 CPU 核心而言，IO APIC 和本地 APIC 之间的传递是远程的。</p>
<p>提交状态等于 1 时，表示中断消息已产生，但还没有发送给本地 APIC。提交模式分为固定（000B）、最低优先级（001B）、SMI（010B）、NMI（100B）、INIT （101B）、ExtINT（111B）等几种。</p>
<p>最低优先级表示把这个中断按照目标 ID 提交给 PPR 最低的 CPU。重定向表的第 7～0 位表示该中断对应的中断向量号，在表 7 中列出了某系统中各个 IRQ 对应的中断向量号。</p>
<p>以上就是对 x86 的中断有了一个简单的了解，后续我们接着来看看 ARM 的 GIC。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">这个名称的由来，是由于绘制架构图时所派生出来的称呼，第一次被提到这名词时是在1991年采用PCl Local Bus架构时。在Intel，PCl规格的创始者视PCI总线为整个PC平台架构的正中央。北桥芯片将PCl总线主干延伸至北边，以支持CPU、存储器或缓存(Cache)、以及其他攸关性能的功能。反之，南桥芯片将PCI总线主干延伸至南边，并桥接起比较非攸关性能的I/O功能，例如磁盘接口等、音效等。</span><br><span class="line">CPU位于架构图的正北方</span><br><span class="line">，它透过较高速的北桥芯片链接北边的系统设备，而北桥则透过较慢速的南桥芯片连接南边的其他系统设备。虽然现今PC平台架构已将PCl总线主干取代，换上更快的I/O主干，但“桥”的传统名称仍然延续使用。</span><br><span class="line"></span><br><span class="line">北桥(英语:Northbridge)是基于Intel处理器的个人电脑主板芯片组两枚芯片中的一枚，北桥用来处理高速信号，例如中央处理器、存储器、显卡(PCI Express接口或AGP接口)，还有与南桥之间的通信。</span><br><span class="line"></span><br><span class="line">北桥芯片位置刚好跟南桥芯片位置相反，它是靠近CPU部分，被散热片覆盖的大的那块芯片，主要功能是负责控制、连接和处理CPU与内存、与南桥通信。北桥芯片是主板的关键芯片，负责管理二级高速缓存，内存的类型和最大容量都由它决定，所以一般主板命名都是用北桥芯片的型号。</span><br><span class="line"></span><br><span class="line">有一些北桥会集成内置显示核心(如Intel GMA)，也支持AGP或PCl Express接口。集成显示核心的北桥若侦测到已安装的PCle/AGP显卡，会停止其GPU功能，但有些北桥可以允许同时使用集成式显卡和安装外加显卡，作为多显示输出。</span><br><span class="line"></span><br><span class="line">英特尔在第一代Core i7中把存储器控制器集成到了CPU，北桥的功能只剩下连接高速设备(如显卡),此时Intel的南桥称为IOH (Io Controller Hub)。从LGA 1156、LGA 2011开始，Intel处理器集成了北桥（存储器控制器、高速PCl Express控制器和Intel HD</span><br><span class="line">Graphics)，主板上只剩下南桥，Intel将其称为平台路径控制器(PCH)。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/7b229a14fec80e0a21f34a6df437d2cd.png"></p>
<h3 id="4、APIC-与-8259A"><a href="#4、APIC-与-8259A" class="headerlink" title="4、APIC 与 8259A"></a>4、APIC 与 8259A</h3><p>APIC 全称是 Advanced Programmable Interrupt Controller，高级可编程中断控制器。</p>
<p>它是在奔腾 P54C 之后被引入进来的。在现在的计算机它通常由两个部分组成，分别为 LAPIC（Local APIC，本地高级可编程中断控制器）和 IOAPIC(I&#x2F;O 高级可编程中断控制器）。</p>
<p><strong>LAPIC 在 CPU 中，IOAPIC 通常位于南桥</strong>。</p>
<p>APIC 是在 PIC (Programmable Interrupt Controller) 的基础上发展而来的。</p>
<p>在传统的单处理器的 PC-AT 兼容的机器，通常使用 8259A 双片级联组成 Legacy 中断控制器（如下图所示）。一共可以连接 15 个设备（有一个管脚被用于串联另一片 8259)。PIC 的优先级规则比较简单，0 号管脚的优先级最高。</p>
<p>PIC 可以通过 ICW（Initialization CommandWord）编程设置起始的 Vector 号。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/72341e4b4f36d4ed99453293f3c3d26a.png"><br>PIC 在单个 CPU 的环境下工作的挺好，可是当系统越来越复杂出现了多个 CPU 的情况，它就没法很好的工作了。这种情况下所有的中断都会丢给主 8259 连接的那个 CPU，那么这个 CPU 就要处理所有的中断，性能上就会有影响。在一个多处理器的系统，任何一个 CPU 都应该能够响应来自任何设备的中断，这种就是所谓的对称式多重处理（Symmetric Multiprocessing）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/c395afd7a0b0af424789fbb77e900872.png"><br>IOAPIC: IOAPIC 的主要作用是中断的分发。最初有一条专门的 APIC 总线用于 IOAPIC 和 LAPIC 通信，在 Pentium4 和 Xeon 系列 CPU 出现后，他们的通信被合并到系统总线中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/2a7ed1b1e690922d9799c57c4de1862d.png"></p>
<p>Virtual Wire Mode: 虚拟接线模式，该模式主要是为了向前兼容，可以理解为就是 PIC。在这种模式下，IOAPIC 会把 8259A 的模拟硬件产生的中断信号直接送给 BSP。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/5d8d4fb5bbb98ebd8c803fa36b56e008.png"></p>
<p>如上图所示，每个 CPU&#x2F;Core 中都有一个 LAPIC。相比较于 IOAPIC， LAPIC 会更复杂一些，它不仅能够处理来自 IOAPIC 的中断消息，它还可以处理 IPI（Inter-Processor Interrupt Messages）,NMI,SMI 和 Init 消息。</p>
<p>LAPIC 默认使用基地址 FEE00000h 开始的 4KB 空间用来访问内部寄存器，从 Pentium Pro 开始引入一个 APIC_BASE 的 MSR，可以用来设置基地址在任何 4KB 对齐的 64GB 内存地址空间。<br>IRR：LAPIC 已经收到中断但是还未提交 CPU 处理。<br>ISR：CPU 已经开始处理中断，但是尚未完成。<br>TMR(Trigger Mode Register)：中断的触发模式。<br>EOI 软件写入表示中断处理完成。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>到这里我们就对 x86 系列的中断有了一个简单的了解，后续我们会继续看一下 ARM 的中断 GIC。</p>
<p>各位周末愉快！！！</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>在这里感谢前辈老师们的优秀书籍与文章，以及丰富的互联网资料。</p>
<ul>
<li>《计算机硬件技术基础》</li>
<li>《汇编语言与接口技术》</li>
<li>《x86&#x2F;x64 体系探索及编程》</li>
<li><a target="_blank" rel="noopener" href="http://www.360doc.com/content/22/1117/08/928863_1056339585.shtml">http://www.360doc.com/content/22/1117/08/928863_1056339585.shtml</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ISA%E6%80%BB%E7%BA%BF/4943942?fr=ge_ala">https://baike.baidu.com/item/ISA%E6%80%BB%E7%BA%BF/4943942?fr=ge_ala</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/PCI/14494010?fr=ge_ala">https://baike.baidu.com/item/PCI/14494010?fr=ge_ala</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/313725721">https://zhuanlan.zhihu.com/p/313725721</a></li>
</ul>
<p>如有遗漏，请联系补充。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">哪吒藕霸</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/')">远辰</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=远辰&amp;url=https://shippomx.github.io/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shippomx.github.io" target="_blank">远辰</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/08/13/linux/%E5%86%85%E5%AD%98/%E9%A1%B5%E8%A1%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-APIC-%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">0 APIC 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-APIC"><span class="toc-number">3.</span> <span class="toc-text">1 APIC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-LAPIC"><span class="toc-number">4.</span> <span class="toc-text">2 LAPIC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-IO-APIC"><span class="toc-number">5.</span> <span class="toc-text">3 IO APIC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81APIC-%E4%B8%8E-8259A"><span class="toc-number">6.</span> <span class="toc-text">4、APIC 与 8259A</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/13/containers/%E4%BB%8E%E7%A1%AC%E4%BB%B6%E7%9C%8B%E4%B8%AD%E6%96%AD%E4%B9%8B%20APIC%EF%BC%88%E4%B8%89%E4%B8%87%EF%BC%89-CSDN%20%E5%8D%9A%E5%AE%A2/" title="无题">无题</a><time datetime="2024-08-13T07:48:29.025Z" title="发表于 2024-08-13 15:48:29">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/13/linux/%E5%86%85%E5%AD%98/%E9%A1%B5%E8%A1%A8/" title="无题">无题</a><time datetime="2024-08-13T06:57:36.023Z" title="发表于 2024-08-13 14:57:36">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/13/containers/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%20%5B%E4%B8%80%5D%20-%20%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/" title="无题">无题</a><time datetime="2024-08-13T06:50:07.571Z" title="发表于 2024-08-13 14:50:07">2024-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/linux/%E5%86%85%E5%AD%98/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20Linux%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" title="无题">无题</a><time datetime="2024-08-12T03:18:47.311Z" title="发表于 2024-08-12 11:18:47">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/31/sdn/dpdk/" title="无题">无题</a><time datetime="2024-07-31T11:36:18.019Z" title="发表于 2024-07-31 19:36:18">2024-07-31</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="哪吒藕霸" target="_blank">哪吒藕霸</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">101</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DPDK/" style="font-size: 0.88rem;">DPDK<sup>3</sup></a><a href="/tags/ONOS/" style="font-size: 0.88rem;">ONOS<sup>1</sup></a><a href="/tags/algorithm/" style="font-size: 0.88rem;">algorithm<sup>1</sup></a><a href="/tags/blockchain/" style="font-size: 0.88rem;">blockchain<sup>1</sup></a><a href="/tags/c/" style="font-size: 0.88rem;">c<sup>1</sup></a><a href="/tags/configuration/" style="font-size: 0.88rem;">configuration<sup>1</sup></a><a href="/tags/container/" style="font-size: 0.88rem;">container<sup>25</sup></a><a href="/tags/go/" style="font-size: 0.88rem;">go<sup>14</sup></a><a href="/tags/kidgets/" style="font-size: 0.88rem;">kidgets<sup>3</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>40</sup></a><a href="/tags/network/" style="font-size: 0.88rem;">network<sup>8</sup></a><a href="/tags/rust/" style="font-size: 0.88rem;">rust<sup>6</sup></a><a href="/tags/sdn/" style="font-size: 0.88rem;">sdn<sup>4</sup></a><a href="/tags/systemtap/" style="font-size: 0.88rem;">systemtap<sup>4</sup></a><a href="/tags/tools/" style="font-size: 0.88rem;">tools<sup>1</sup></a><a href="/tags/tvbox/" style="font-size: 0.88rem;">tvbox<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 哪吒藕霸 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>