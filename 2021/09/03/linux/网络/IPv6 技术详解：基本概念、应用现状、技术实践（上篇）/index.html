<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>IPV6详解 | 远辰</title><meta name="keywords" content="linux"><meta name="author" content="哪吒藕霸"><meta name="copyright" content="哪吒藕霸"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="IPV6详解"><meta name="application-name" content="IPV6详解"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="IPV6详解"><meta property="og:url" content="https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/index.html"><meta property="og:site_name" content="远辰"><meta property="og:description" content="4、初识 IPv6 ▲ 图 1：IPv6 数据报文 上图是我们最熟悉的 ping 的 IPv6 版本 ICMPv6，可以看到，IPv6 数据报文和 IPv4 有很大的差别：  1）数据链路层（L2）的 type 字段标识为 0x86dd，表示承载的上层协议是 IPv6（IPv4 对比：type 字段"><meta property="og:locale" content="zh"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="哪吒藕霸"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="4、初识 IPv6 ▲ 图 1：IPv6 数据报文 上图是我们最熟悉的 ping 的 IPv6 版本 ICMPv6，可以看到，IPv6 数据报文和 IPv4 有很大的差别：  1）数据链路层（L2）的 type 字段标识为 0x86dd，表示承载的上层协议是 IPv6（IPv4 对比：type 字段"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 哪吒藕霸","link":"链接: ","source":"来源: 远辰","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '远辰',
  title: 'IPV6详解',
  postAI: '',
  pageFillDescription: '4、初识 IPv6, 5、IPv6 的地址语法, 6、IPv6 地址的号段划分和前缀表示法, 7、IPv6 的地址类型, 8、IPv6 单播地址, 8.1 全球单播地址, 8.2 链路本地地址, 8.3 唯一本地地址, 8.4 站点本地地址, 8.5 特殊地址：回环地址, 8.6 过渡地址：内嵌 IPv4 地址的 IPv6 地址, 9、IPv4 兼容地址, 10、IPv6 接口 ID 生成算法, 11、IPv6 地址配置, 12、IPv6 的域名解析, 附录：更多相关文章初识图数据报文上图是我们最熟悉的的版本可以看到数据报文和有很大的差别数据链路层的字段标识为表示承载的上层协议是对比字段为的头部字段和差别巨大可以猜测到和无法兼容的报文头部格式如下图报文头部报文头部更精简了字段更少了对比起有以下几个地方值得注意报文头部是定长固定为字节报文头部是变长的这个意味着写代码处理数据报文的效率会提高很多中字段含义类似的中的字段含义类似中的的报文头部取消了校验和字段取消这个字段也是对协议的一个改进当报文在网路间传输每经过一个路由器转发就是修改字段就需要重新计算校验和而由于数据链路层和传输层的校验已经足够强壮因此取消这个字段会提高路由器的转发效率值得一提的是在协议下传输层协议是强制需要进行校验和的是可选的报文头部中的字段表示承载上一层的协议类型或者扩展头部类型这里的含义与有很大的差别需要加以解释当数据报文承载的是上层协议等的时候的值分别为这个时候和报文头部中的字段很类似当不是以上种协议类型的时候报文头部紧接的是扩展头部扩展头部是引入的一个新的概念每个的数据报文可以承载个或多个扩展头部扩展头部通过链表的形式组织起来当数据报文承载着扩展头部的时候的数值为扩展头部的类型值为什么要引入扩展头部这个概念这里也是对改进的一个方面用扩展头部取代了的可选项信息精简了的头部增强了的扩展性有同学会不会有疑问的分片数据报文怎么处理其实就是使用了扩展头部我们来抓一个分片报文来看看图分片报文当发送一个分片数据报文的时候使用的是扩展头部的形式组织各个分片的信息如图报文头部字段值为表示存在扩展头部扩展头部是分片数据信息对比分片信息是记录在报文头部的分片字段中的扩展头部类型有很多种除了上述的分片头部还有路由头部逐跳可选头部等具体的可以参考本章主要介绍了的一些很直观的认识下面逐渐介绍上的基本知识和概念的地址语法一个的地址使用冒号十六进制表示方法位的地址每位分成一段每个位的段用十六进制表示并用冒号分隔开例如一个普通公网地址地址支持压缩前导零的表示方法例如上面的地址可以压缩表示为为了进一步精简地址当冒号十六进制格式中出现连续几段数值的位段时这些段可以压缩为双冒号的表示例如上面的地址还可以进一步精简表示为又例如的地址可以进一步精简表示为这里值得注意的是双冒号只能出现一次地址的号段划分和前缀表示法拥有位巨大的地址空间对于那么大的空间也不是随意的划分而是使用按照位进行号段划分与鹅厂内部一些的位改造放号的划分算法的地址结构如下图图地址结构例如中定义了也就是子网和接口与各占位支持子网前缀标识方法类似于的无分类域间路由机制注意没有子网掩码的概念使用地址前缀长度表示方法例如表示一个子网而表示该子网下的一个节点地址可以看到一个的地址有子网前缀接口构成子网前缀由地址分配和管理机构定义和分配而接口可以由各操作系统实现生成生成算法后面的章节会介绍的地址类型地址分三种类型单播对应于的普通公网和私网地址组播对应于的组播多播地址任播新增的地址概念类型没有广播地址用组播地址实现广播的功能实际上我们工作和生活最可能最多接触的就是单播地址接下来本文重点会讲解单播地址的种类组播和任播地址有兴趣的同学自行查阅相关和文献单播地址注意大家如果在网上搜索的地址可能都是千篇一律的把所有出现过的单播地址介绍出来其实有一些单播地址类型已经在相关的中被废除或者不建议使用而本节会指出这类地址同时在介绍单播地址的时候尽量与中对应的或者相类似的概念做对比加深理解单播地址有以下几种全球单播地址图全球单播地址结构前缀相当于的公网地址的诞生根本上就是为了解决公网地址耗尽的问题这种地址在全球的路由器间可以路由链路本地地址图链路本地地址结构前缀顾名思义此类地址用于同一链路上的节点间的通信主要用于自动配置地址和邻居节点发现过程和支持或开启后默认会给网卡接口自动配置一个链路本地地址也就是说一个接口一定有一个链路本地地址如下图图下查看链路本地地址图下查看链路本地地址值得说的是每个接口必须至少有一个链路本地地址每个接口可以配置个以上的单播地址例如一个接口可以配置一个链路本地地址同时也可以配置一个全球单播地址注意很容易会把链路本地地址和的私网内网地址对应起来其实链路本地地址对应于的地址也就是开头的地址典型场景就是开启自动获取地址而获取失败后自动分配一个的地址而私网对应于的什么地址后面会介绍特别地在编程中可以使用链路本地地址编程通信但是需要增加一些额外的参数这是一个小坑在后面介绍编程的章节会介绍唯一本地地址图唯一本地地址结构前缀相当于的私网地址在中新定义的一种解决私网需求的单播地址类型用来代替废弃使用的站点本地地址可能看到这里有同学会跳出来说不是为了解决地址耗尽的问题吗既然的地址空间那么大可以为每一个网络节点分配公网的节点那为什么还需要支持私网这里需要谈谈对下私网支持的认识在中利用技术私网内的网络节点可以使用统一的公网出口访问互联网资源大大节省了公网地址的消耗推进缓慢的原因之一另一方面由于默认情况下私网内节点与外界通信的发起是单向的网络访问仅仅能从私网内发起外部发起的请求会被统一网关或者防火墙阻隔掉这样的网络架构很好的保护了私网内的节点安全性和私密性可以设想一下如果鹅厂内部每台办公电脑都配置了的公网地址上网是多么可怕的事情每台办公电脑都会面临被黑客入侵的威胁肉鸡真多因此在安全性和私密性要求下中同样需要支持私网并且也需要支持在内核版本开始加入对的支持实现的方式和下的差别不大内核代码中变量和函数的命名几乎就是和过来的站点本地地址前缀以前是用来部署私网的但中已经不建议使用这类地址建议使用唯一本地地址大家知道有这么一回事就可以了网上还有很多文章还提到这种地址但是没有说明这种地址已经不再使用特殊地址回环地址或等同于的过渡地址内嵌地址的地址就是在的某一些十六进制段内嵌这的地址例如地址中此地址最后个字节内嵌一个的地址这类地址主要用于的过渡技术中兼容地址或其中是点分十进制的地址但在中已经不推荐使用这类地址大家知道有这么一回事就可以了过渡地址映射地址或其中是点分十进制的地址用于地址表示地址主要用于某些场景下节点与节点通信内核对这类地址很好地支持在后面编程和内核分析的章节会分析使用过程过渡地址特定过渡技术地址地址地址地址主要用于对应的过渡技术的地址在后面介绍过渡技术的时候会介绍接口生成算法从前面的介绍中可以看出单播地址是由前缀位接口位组成接口的生成算法主要有以下几种根据定义接口可以从地址生成详细算法可以查看同学的第页为了可以具备某种程度的匿名信接口可以使用一个随机分配的操作系统默认就是使用这种生成算法下也是默认开启这个算法使用状态化的自动配置技术分配例如分配手工配置地址配置前面对的地址前缀接口等等做了介绍接下来就是要介绍一个接口如何配置地址一个比更厉害的方面就是可以自动配置地址甚至这个配置过程不需要在中是这样的地址配置协议最典型的例子就是只要开启了协议栈的操作系统每个接口就能自动配置了链路本地地址这个是和最重要的区别之一的地址配置有以下几种只要开启了协议栈接口自动分配链路本地地址无状态自动配置地址后面会有实验演示有状态自动配置地址例如手动配置的域名解析由于的地址扩展为位比的更难书写和记忆因此下的变得尤为重要的的资源记录类型为又称作用于解析指向地址的完全有效域名下面是一个示例下的域名解析可以认为是的扩展详细可以查看本文未完下篇待续附录更多相关文章更多网络编程基础资料详解第章用户数据报协议详解第章传输控制协议详解第章连接的建立与终止详解第章的超时与重传技术往事改变世界的协议珍贵多图手机慎点通俗易懂深入理解协议上理论基础通俗易懂深入理解协议下滑动窗口拥塞处理理论经典协议的次握手与次挥手过程详解理论联系实际抓包分析次握手次挥手过程计算机网络通讯协议关系图中文珍藏版中一个包的大小最大能多大技术详解一详解详细原理简介技术详解二中的穿越打洞方案详解技术详解三技术之详解通俗易懂快速理解技术中的穿透原理高性能网络编程一单台服务器并发连接数到底可以有多少高性能网络编程二上一个年著名的并发连接问题高性能网络编程三下一个年是时候考虑并发问题了高性能网络编程四从到高性能网络应用的理论探索不为人知的网络编程一浅析协议中的疑难杂症上篇不为人知的网络编程二浅析协议中的疑难杂症下篇不为人知的网络编程三关闭连接时为什么会不为人知的网络编程四深入研究分析的异常关闭不为人知的网络编程五的连接性和负载均衡不为人知的网络编程六深入地理解协议并用好它不为人知的网络编程七如何让不可靠的变的可靠网络编程懒人入门一快速理解网络通信协议上篇网络编程懒人入门二快速理解网络通信协议下篇网络编程懒人入门三快速理解协议一篇就够网络编程懒人入门四快速理解和的差异网络编程懒人入门五快速理解为什么说有时比更有优势技术扫盲新一代基于的低延时网络传输层协议详解让互联网更快新一代协议在腾讯的技术实践分享现代移动端网络短连接的优化手段总结请求速度弱网适应安全保障聊聊中网络编程长连接的那些事移动端开发者必读一通俗易懂理解移动网络的弱和慢移动端开发者必读二史上最全移动弱网络优化方法总结技术详解基本概念应用现状技术实践上篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-28 16:22:11',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">远辰</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/algorithm/" style="font-size: 1.05rem;">algorithm<sup>1</sup></a><a href="/tags/blockchain/" style="font-size: 1.05rem;">blockchain<sup>1</sup></a><a href="/tags/c/" style="font-size: 1.05rem;">c<sup>1</sup></a><a href="/tags/container/" style="font-size: 1.05rem;">container<sup>27</sup></a><a href="/tags/go/" style="font-size: 1.05rem;">go<sup>11</sup></a><a href="/tags/kidgets/" style="font-size: 1.05rem;">kidgets<sup>3</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>22</sup></a><a href="/tags/rust/" style="font-size: 1.05rem;">rust<sup>6</sup></a><a href="/tags/sdn/" style="font-size: 1.05rem;">sdn<sup>1</sup></a><a href="/tags/tools/" style="font-size: 1.05rem;">tools<sup>1</sup></a><a href="/tags/tvbox/" style="font-size: 1.05rem;">tvbox<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">December 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">July 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">June 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">May 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">April 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">March 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>linux</span></a></span></div></div><h1 class="post-title" itemprop="name headline">IPV6详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-09-03T12:07:24.000Z" title="发表于 2021-09-03 20:07:24">2021-09-03</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-09-28T08:22:11.107Z" title="更新于 2023-09-28 16:22:11">2023-09-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/"><header><a href="/tags/linux/" tabindex="-1" itemprop="url">linux</a><h1 id="CrawlerTitle" itemprop="name headline">IPV6详解</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">哪吒藕霸</span><time itemprop="dateCreated datePublished" datetime="2021-09-03T12:07:24.000Z" title="发表于 2021-09-03 20:07:24">2021-09-03</time><time itemprop="dateCreated datePublished" datetime="2023-09-28T08:22:11.107Z" title="更新于 2023-09-28 16:22:11">2023-09-28</time></header><h2 id="4、初识-IPv6"><a href="#4、初识-IPv6" class="headerlink" title="4、初识 IPv6"></a>4、初识 IPv6</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-9acba3dd0aae5755af46fe6c69c725eb_r.jpg"></p>
<p>▲ 图 1：IPv6 数据报文</p>
<p><strong>上图是我们最熟悉的 ping 的 IPv6 版本 ICMPv6，可以看到，IPv6 数据报文和 IPv4 有很大的差别：</strong></p>
<ul>
<li>1）数据链路层（L2）的 type 字段标识为 0x86dd，表示承载的上层协议是 IPv6（IPv4 对比：type 字段为 0x0800）；</li>
<li>2）IPv6 的头部字段，和 IPv4 差别巨大（可以猜测到，IPv6 和 IPv4 无法兼容）。</li>
</ul>
<p><strong>IPv6 的报文头部格式如下：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic3.zhimg.com/v2-250c8cb0580c156fd7827f1bb4606d5a_r.jpg"></p>
<p>▲ 图 2：IPv6 报文头部</p>
<p><strong>IPv6 报文头部更精简了，字段更少了，对比起 IPv4，有以下几个地方值得注意：</strong></p>
<ul>
<li>1）IPv6 报文头部是定长（固定为 40 字节），IPv4 报文头部是变长的。这个意味着，写代码处理 IPv6 数据报文的效率会提高很多：）；</li>
<li>2）IPv6 中 Hop Limit 字段含义类似 IPv4 的 TTL；</li>
<li>3）IPv6 中的 Traffic Class 字段含义类似 IPv4 中的 TOS（Type Of Service）；</li>
<li>4）IPv6 的报文头部取消了校验和字段：取消这个字段也是对 IPv4 协议的一个改进。当 IPv4 报文在网路间传输，每经过一个路由器转发就是修改 TTL 字段，就需要重新计算校验和，而由于数据链路层 L2 和传输层 L4 的校验已经足够强壮，因此 IPv6 取消这个字段会提高路由器的转发效率。值得一提的是，在 IPv6 协议下，传输层 L4 协议 UDP、TCP 是强制需要进行校验和的（IPv4 是可选的）；</li>
<li>5）IPv6 报文头部中的 Next Header 字段表示 “承载上一层的协议类型” 或者“扩展头部类型”。</li>
</ul>
<p><strong>这里的含义与 IPv4 有很大的差别，需要加以解释：</strong></p>
<ul>
<li>当 IPv6 数据报文承载的是上层协议 ICMPv6、TCP、UDP 等的时候，Next Header 的值分别为 58、6、17，这个时候和 IPv4 报文头部中的 Protocol 字段很类似;</li>
<li>当不是以上 3 种协议类型的时候，IPv6 报文头部紧接的是扩展头部。扩展头部是 IPv6 引入的一个新的概念，每个 IPv6 的数据报文可以承载 0 个或多个扩展头部，扩展头部通过链表的形式组织起来。当 IPv6 数据报文承载着扩展头部的时候，Next Header 的数值为扩展头部的类型值。</li>
</ul>
<p>为什么要引入扩展头部这个概念，这里也是 IPv6 对 IPv4 改进的一个方面，用扩展头部取代了 IPv4 的可选项信息，精简了 IPv6 的头部，增强了 IPv6 的扩展性。有同学会不会有疑问，IPv6 的分片数据报文怎么处理？其实就是使用了 IPv6 扩展头部。我们来抓一个 UDP 分片报文来看看。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-67fb1b45a60fa2c5279c69f8497feadc_r.jpg"></p>
<p>▲ 图 3：IPv6 分片报文</p>
<p>当发送一个分片 IPv6 数据报文的时候，IPv6 使用的是扩展头部的形式组织各个分片的信息，如图 IPv6 报文头部 Next Header 字段值为 44 表示存在扩展头部，扩展头部是 IPv6 分片数据信息。</p>
<p>对比 IPv4，分片信息是记录在 IPv4 报文头部的分片字段中。</p>
<p>IPv6 的扩展头部类型有很多种，除了上述的分片头部，还有路由头部、逐跳可选头部等，具体的可以参考 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc2460">RFC2460</a>。</p>
<p>本章主要介绍了 IPv6 的一些很直观的认识，下面逐渐介绍 IPv6 上的基本知识和概念。</p>
<h2 id="5、IPv6-的地址语法"><a href="#5、IPv6-的地址语法" class="headerlink" title="5、IPv6 的地址语法"></a>5、IPv6 的地址语法</h2><p>一个 IPv6 的地址使用冒号十六进制表示方法：128 位的地址每 16 位分成一段，每个 16 位的段用十六进制表示并用冒号分隔开，例如：<br>一个普通公网 IPv6 地址：2001:0D12:0000:0000:02AA:0987:FE29:9871</p>
<p>IPv6 地址支持压缩前导零的表示方法，例如上面的地址可以压缩表示为：<br>2001 12:0:0:2AA:987:FE29:9871</p>
<p>为了进一步精简 IPv6 地址，当冒号十六进制格式中出现连续几段数值 0 的位段时，这些段可以压缩为双冒号的表示，例如上面的地址还可以进一步精简表示为：<br>2001 12::2AA:987:FE29:9871</p>
<p>又例如 IPv6 的地址 FF80:0:0:0:FF:3BA:891:67C2 可以进一步精简表示为：<br>FE80::FF:3BA:891:67C2</p>
<p>这里值得注意的是：双冒号只能出现一次。</p>
<h2 id="6、IPv6-地址的号段划分和前缀表示法"><a href="#6、IPv6-地址的号段划分和前缀表示法" class="headerlink" title="6、IPv6 地址的号段划分和前缀表示法"></a>6、IPv6 地址的号段划分和前缀表示法</h2><p>IPv6 拥有 128 位巨大的地址空间，对于那么大的空间，也不是随意的划分，而是使用按照 bit 位进行号段划分（与鹅厂内部一些的 64 位 uin 改造放号的 zone 划分算法）。</p>
<p><strong>IPv6 的地址结构如下图：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-3670e759008dd9549199aa30d85e7a1b_r.jpg"></p>
<p>▲ 图 4：IPv6 地址结构</p>
<p>例如 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc4291">RFC4291</a> 中定义了 n&#x3D;48, m&#x3D;16，也就是子网和接口 ID 与各占 64 位。</p>
<p>IPv6 支持子网前缀标识方法，类似于 IPv4 的无分类域间路由 CIDR 机制（<strong>注意：</strong>IPv6 没有子网掩码 mask 的概念）。</p>
<p><strong>使用 “IPv6 地址 &#x2F; 前缀长度” 表示方法，例如：</strong></p>
<ul>
<li>2001:C3:0:2C6A::&#x2F;64 表示一个子网；</li>
<li>而 2001:C3:0:2C6A:C9B4:FF12:48BC:1A22&#x2F;64 表示该子网下的一个节点地址。</li>
</ul>
<p>可以看到，一个 IPv6 的地址有子网前缀 + 接口 ID 构成，子网前缀由地址分配和管理机构定义和分配，而接口 ID 可以由各操作系统实现生成，生成算法后面的章节会介绍。</p>
<h2 id="7、IPv6-的地址类型"><a href="#7、IPv6-的地址类型" class="headerlink" title="7、IPv6 的地址类型"></a>7、IPv6 的地址类型</h2><p><strong>IPv6 地址分三种类型：</strong></p>
<ul>
<li>1）单播，对应于 IPv4 的普通公网和私网地址；</li>
<li>2）组播，对应于 IPv4 的组播（多播）地址；</li>
<li>3）任播，IPv6 新增的地址概念类型。</li>
</ul>
<p>IPv6 没有广播地址，用组播地址实现广播的功能。实际上我们工作和生活最可能最多接触的就是单播地址，接下来本文重点会讲解单播地址的种类。组播和任播地址有兴趣的同学自行查阅相关 RFC 和文献。</p>
<h2 id="8、IPv6-单播地址"><a href="#8、IPv6-单播地址" class="headerlink" title="8、IPv6 单播地址"></a>8、IPv6 单播地址</h2><p><strong>注意：</strong>大家如果在网上搜索 IPv6 的地址，可能都是千篇一律的把所有 “出现过” 的单播地址介绍出来，其实有一些单播地址类型已经在相关的 RFC 中被废除或者不建议使用，而本节会指出这类地址。同时，在介绍单播地址的时候，尽量与 IPv4 中对应的或者相类似的概念做对比，加深理解。</p>
<p>IPv6 单播地址有以下几种。</p>
<h2 id="8-1-全球单播地址"><a href="#8-1-全球单播地址" class="headerlink" title="8.1 全球单播地址"></a>8.1 全球单播地址</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-71cf98357e421cd76fecbbcfc4174973_r.jpg"></p>
<p>▲ 图 5：IPv6 全球单播地址结构</p>
<p>前缀 2000::&#x2F;3，相当于 IPv4 的公网地址（IPv6 的诞生根本上就是为了解决 IPv4 公网地址耗尽的问题）。这种地址在全球的路由器间可以路由。</p>
<h2 id="8-2-链路本地地址"><a href="#8-2-链路本地地址" class="headerlink" title="8.2 链路本地地址"></a>8.2 链路本地地址</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-837126f4da1643ad630ab75c6a60a4d0_r.jpg"></p>
<p>▲ 图 6：链路本地地址结构</p>
<p>前缀 FE80::&#x2F;10，顾名思义，此类地址用于同一链路上的节点间的通信，主要用于自动配置地址和邻居节点发现过程。Windows 和 Linux 支持或开启 IPv6 后，默认会给网卡接口自动配置一个链路本地地址。也就是说，一个接口一定有一个链路本地地址。</p>
<p><strong>如下图：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic3.zhimg.com/v2-fc0507a0422f0c705e878a4fe3a9342a_r.jpg"></p>
<p>▲ 图 7：Linux 下查看链路本地地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-56cceb86837f08a346e14e914e12f4fc_b.jpg"></p>
<p>▲ 图 8：Windows 下查看链路本地地址</p>
<p><strong>值得说的是：</strong>每个接口必须至少有一个链路本地地址；每个接口可以配置 1 个以上的单播地址，例如一个接口可以配置一个链路本地地址，同时也可以配置一个全球单播地址。</p>
<p><strong>注意：</strong>很容易会把链路本地地址和 IPv4 的私网 &#x2F; 内网地址对应起来，其实链路本地地址对应于 IPv4 的 APIPA 地址，也就是 169.254 开头的地址（典型场景就是 windows 开启自动获取地址而获取失败后自动分配一个 169.254 的地址）。而 IPv4 私网对应于 IPv6 的什么地址，后面会介绍。</p>
<p><strong>特别地：</strong>在 IPv6 socket 编程中，可以使用链路本地地址编程通信，但是需要增加一些额外的参数（这是一个小坑），在后面介绍编程的章节会介绍。</p>
<h2 id="8-3-唯一本地地址"><a href="#8-3-唯一本地地址" class="headerlink" title="8.3 唯一本地地址"></a>8.3 唯一本地地址</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-d645e4c596a2fbdda4f398742bb3957f_r.jpg"></p>
<p>▲ 图 9：唯一本地地址结构</p>
<p>前缀 FC00::&#x2F;7，相当于 IPv4 的私网地址（10.0.0.0、172.16.0.0、192.168.0.0），在 RFC4193 中新定义的一种解决私网需求的单播地址类型，用来代替废弃使用的站点本地地址。</p>
<p><strong>可能看到这里，有同学会跳出来说：</strong>IPv6 不是为了解决 IPv4 地址耗尽的问题吗，既然 IPv6 的地址空间那么大，可以为每一个网络节点分配公网 IPv6 的节点，那为什么 IPv6 还需要支持私网？这里需要谈谈对 IPv6 下私网支持的认识。</p>
<p>在 IPv4 中，利用 NAT 技术私网内的网络节点可以使用统一的公网出口访问互联网资源，大大节省了 IPv4 公网地址的消耗（IPv6 推进缓慢的原因之一）。另一方面，由于默认情况下私网内节点与外界通信的发起是单向的，网络访问仅仅能从私网内发起，外部发起的请求会被统一网关或者防火墙阻隔掉，这样的网络架构很好的保护了私网内的节点安全性和私密性。可以设想一下，如果鹅厂内部每台办公电脑都配置了 IPv6 的公网地址上网，是多么可怕的事情，每台办公电脑都会面临被黑客入侵的威胁（肉鸡真多）。</p>
<p>因此，在安全性和私密性要求下，IPv6 中同样需要支持私网，并且也需要支持 NAT。在 Linux 内核 3.7 版本开始加入对 IPv6 NAT 的支持，实现的方式和 IPv4 下的差别不大（Linux 内核代码中变量和函数的命名几乎就是 ctrl+c 和 ctrl+v 过来的 -_-||）。</p>
<h2 id="8-4-站点本地地址"><a href="#8-4-站点本地地址" class="headerlink" title="8.4 站点本地地址"></a>8.4 站点本地地址</h2><p>前缀 FEC9::&#x2F;48，以前是用来部署私网的，但 RFC3879 中已经不建议使用这类地址，建议使用唯一本地地址。大家知道有这么一回事就可以了。网上还有很多文章还提到这种地址，但是没有说明这种地址已经不再使用。</p>
<h2 id="8-5-特殊地址：回环地址"><a href="#8-5-特殊地址：回环地址" class="headerlink" title="8.5 特殊地址：回环地址"></a>8.5 特殊地址：回环地址</h2><p>0:0:0:0:0:0:0:1 或::1，等同于 IPv4 的 127.0.0.1</p>
<h2 id="8-6-过渡地址：内嵌-IPv4-地址的-IPv6-地址"><a href="#8-6-过渡地址：内嵌-IPv4-地址的-IPv6-地址" class="headerlink" title="8.6 过渡地址：内嵌 IPv4 地址的 IPv6 地址"></a>8.6 过渡地址：内嵌 IPv4 地址的 IPv6 地址</h2><p>就是在 IPv6 的某一些十六进制段内嵌这 IPv4 的地址，例如 IPv6 地址中 64:ff9b::10.10.10.10，此 IPv6 地址最后 4 个字节内嵌一个 IPv4 的地址，这类地址主要用于 IPv6&#x2F;IPv4 的过渡技术中。</p>
<h2 id="9、IPv4-兼容地址"><a href="#9、IPv4-兼容地址" class="headerlink" title="9、IPv4 兼容地址"></a>9、IPv4 兼容地址</h2><p>0:0:0:0:0:0:w.x.y.z 或::w.x.y.z（其中 w.x.y.z 是点分十进制的 IPv4 地址）。但在 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc4291">RFC4291</a> 中已经不推荐使用这类地址，大家知道有这么一回事就可以了。</p>
<p><strong>过渡地址：IPv4 映射地址</strong><br>0:0:0:0:0:FFFF:w.x.y.z 或::FFFF:w.x.y.z（其中 w.x.y.z 是点分十进制的 IPv4 地址），用于 IPv6 地址表示 IPv4 地址。主要用于某些场景下 IPv6 节点与 IPv4 节点通信，Linux 内核对这类地址很好地支持，在后面编程和内核分析的章节会分析使用过程。</p>
<p><strong>过渡地址：特定过渡技术地址</strong></p>
<p>6to4 地址、ISATAP 地址、Teredo 地址主要用于对应的过渡技术的地址，在后面介绍过渡技术的时候会介绍。</p>
<h2 id="10、IPv6-接口-ID-生成算法"><a href="#10、IPv6-接口-ID-生成算法" class="headerlink" title="10、IPv6 接口 ID 生成算法"></a>10、IPv6 接口 ID 生成算法</h2><p>从前面的介绍中可以看出，IPv6 单播地址是由前缀（64 位）+ 接口 ID（64 位）组成。</p>
<p><strong>接口 ID 的生成算法主要有以下几种：</strong></p>
<ul>
<li>1）根据 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc4291">RFC4291</a> 定义，接口 ID 可以从 EUI-64 地址生成：详细算法可以查看 regli 同学的 PPT 第 14 页；</li>
<li>2）为了可以具备某种程度的匿名信，接口 ID 可以使用一个随机分配的，windows 操作系统默认就是使用这种生成算法，Linux 下也是默认开启这个算法；</li>
<li>3）使用状态化的自动配置技术分配，例如 DHCPv6 分配；</li>
<li>4）手工配置。</li>
</ul>
<h2 id="11、IPv6-地址配置"><a href="#11、IPv6-地址配置" class="headerlink" title="11、IPv6 地址配置"></a>11、IPv6 地址配置</h2><p>前面对 IPv6 的地址、前缀、接口等等做了介绍，接下来就是要介绍一个接口如何配置 IPv6 地址。IPv6 一个比 IPv4 更厉害的方面，就是可以自动配置地址，甚至这个配置过程不需要 DHCPv6（在 IPv4 中是 DHCPv4）这样的地址配置协议。最典型的例子就是，只要开启了 IPv6 协议栈的操作系统，每个接口就能自动配置了链路本地地址，这个是和 IPv4 最重要的区别之一。</p>
<p><strong>IPv6 的地址配置有以下几种：</strong></p>
<ul>
<li>1）只要开启了 IPv6 协议栈，接口自动分配链路本地地址；</li>
<li>2）无状态自动配置地址（<a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc2462">RFC2462</a>），后面会有实验演示；</li>
<li>3）有状态自动配置地址，例如 DHCPv6。</li>
<li>4）手动配置。</li>
</ul>
<h2 id="12、IPv6-的域名解析"><a href="#12、IPv6-的域名解析" class="headerlink" title="12、IPv6 的域名解析"></a>12、IPv6 的域名解析</h2><p>由于 IPv6 的地址扩展为 128 位，比 IPv4 的更难书写和记忆，因此 IPv6 下的 DNS 变得尤为重要。IPv6 的的 DNS 资源记录类型为 AAAA（又称作 4A），用于解析指向 IPv6 地址的完全有效域名。</p>
<p><strong>下面是一个示例：</strong><br><a href="https://link.zhihu.com/?target=http://Hostipv6.example.wechat.com">http://Hostipv6.example.wechat.com</a> IN AAAA 2001:db8:1::1</p>
<p>IPv6 下的域名解析可以认为是 IPv4 的扩展，详细可以查看 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc3596">RFC3596</a>.</p>
<p><strong>（—— 本文未完，下篇待续 ——）</strong></p>
<h2 id="附录：更多相关文章"><a href="#附录：更多相关文章" class="headerlink" title="附录：更多相关文章"></a>附录：更多相关文章</h2><blockquote>
<p><strong>[1] 更多网络编程基础资料：</strong><br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/topic-tcpipvol1.html">TCP&#x2F;IP 详解</a> - <a href="https://link.zhihu.com/?target=http://docs.52im.net/extend/docs/book/tcpip/vol1/11/">第 11 章 ·UDP：用户数据报协议</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/topic-tcpipvol1.html">TCP&#x2F;IP 详解</a> - <a href="https://link.zhihu.com/?target=http://docs.52im.net/extend/docs/book/tcpip/vol1/17/">第 17 章 ·TCP：传输控制协议</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/topic-tcpipvol1.html">TCP&#x2F;IP 详解</a> - <a href="https://link.zhihu.com/?target=http://docs.52im.net/extend/docs/book/tcpip/vol1/18/">第 18 章 ·TCP 连接的建立与终止</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/topic-tcpipvol1.html">TCP&#x2F;IP 详解</a> - <a href="https://link.zhihu.com/?target=http://docs.52im.net/extend/docs/book/tcpip/vol1/21/">第 21 章 ·TCP 的超时与重传</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-520-1-1.html">技术往事：改变世界的 TCP&#x2F;IP 协议（珍贵多图、手机慎点）</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-513-1-1.html">通俗易懂 - 深入理解 TCP 协议（上）：理论基础</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-515-1-1.html">通俗易懂 - 深入理解 TCP 协议（下）：RTT、滑动窗口、拥塞处理</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-258-1-1.html">理论经典：TCP 协议的 3 次握手与 4 次挥手过程详解</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-275-1-1.html">理论联系实际：Wireshark 抓包分析 TCP 3 次握手、4 次挥手过程</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-180-1-1.html">计算机网络通讯协议关系图（中文珍藏版）</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-29-1-1.html">UDP 中一个包的大小最大能多大？</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-50-1-1.html">P2P 技术详解 (一)：NAT 详解——详细原理、P2P 简介</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-542-1-1.html">P2P 技术详解 (二)：P2P 中的 NAT 穿越(打洞) 方案详解</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-557-1-1.html">P2P 技术详解 (三)：P2P 技术之 STUN、TURN、ICE 详解</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1055-1-1.html">通俗易懂：快速理解 P2P 技术中的 NAT 穿透原理</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-561-1-1.html">高性能网络编程 (一)：单台服务器并发 TCP 连接数到底可以有多少</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-566-1-1.html">高性能网络编程 (二)：上一个 10 年，著名的 C10K 并发连接问题</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-568-1-1.html">高性能网络编程 (三)：下一个 10 年，是时候考虑 C10M 并发问题了</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-578-1-1.html">高性能网络编程 (四)：从 C10K 到 C10M 高性能网络应用的理论探索</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1003-1-1.html">不为人知的网络编程 (一)：浅析 TCP 协议中的疑难杂症 (上篇)</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1004-1-1.html">不为人知的网络编程 (二)：浅析 TCP 协议中的疑难杂症 (下篇)</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1007-1-1.html">不为人知的网络编程 (三)：关闭 TCP 连接时为什么会 TIME_WAIT、CLOSE_WAIT</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1014-1-1.html">不为人知的网络编程 (四)：深入研究分析 TCP 的异常关闭</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1018-1-1.html">不为人知的网络编程 (五)：UDP 的连接性和负载均衡</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1024-1-1.html">不为人知的网络编程 (六)：深入地理解 UDP 协议并用好它</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1293-1-1.html">不为人知的网络编程 (七)：如何让不可靠的 UDP 变的可靠？</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1095-1-1.html">网络编程懒人入门 (一)：快速理解网络通信协议（上篇）</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1103-1-1.html">网络编程懒人入门 (二)：快速理解网络通信协议（下篇）</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1107-1-1.html">网络编程懒人入门 (三)：快速理解 TCP 协议一篇就够</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1160-1-1.html">网络编程懒人入门 (四)：快速理解 TCP 和 UDP 的差异</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1277-1-1.html">网络编程懒人入门 (五)：快速理解为什么说 UDP 有时比 TCP 更有优势</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1309-1-1.html">技术扫盲：新一代基于 UDP 的低延时网络传输层协议——QUIC 详解</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1407-1-1.html">让互联网更快：新一代 QUIC 协议在腾讯的技术实践分享</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1413-1-1.html">现代移动端网络短连接的优化手段总结：请求速度、弱网适应、安全保障</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1493-1-1.html">聊聊 iOS 中网络编程长连接的那些事</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1587-1-1.html">移动端 IM 开发者必读 (一)：通俗易懂，理解移动网络的“弱” 和“慢”</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1588-1-1.html">移动端 IM 开发者必读 (二)：史上最全移动弱网络优化方法总结</a>》<br>《<a href="https://link.zhihu.com/?target=http://www.52im.net/thread-1605-1-1.html">IPv6 技术详解：基本概念、应用现状、技术实践（上篇）</a>》  </p>
</blockquote>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">哪吒藕霸</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/')">IPV6详解</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=IPV6详解&amp;url=https://shippomx.github.io/2021/09/03/linux/%E7%BD%91%E7%BB%9C/IPv6%20%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E3%80%81%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6%E3%80%81%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shippomx.github.io" target="_blank">远辰</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>linux<span class="tagsPageCount">22</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/09/03/linux/%E7%BD%91%E7%BB%9C/iptables%20%E8%AF%A6%E8%A7%A3%E5%8F%8A%20docker%20%E7%9A%84%20iptables%20%E8%A7%84%E5%88%99/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">iptables 规则详解</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/09/rust/Rust%20%E6%80%A7%E8%83%BD%E8%AF%84%E4%BC%B0%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E8%B7%B5/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Rust 性能优化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2017/06/08/Nginx%20%E9%85%8D%E7%BD%AE%20HTTPS%20%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="Nginx 配置 HTTPS 服务器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2017-06-08</div><div class="title">Nginx 配置 HTTPS 服务器</div></div></a></div><div><a href="/2023/02/14/linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="简易环境配置"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-02-14</div><div class="title">简易环境配置</div></div></a></div><div><a href="/2023/06/21/pty-studio/" title="使用c代码实现伪终端"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-21</div><div class="title">使用c代码实现伪终端</div></div></a></div><div><a href="/2023/06/21/vscode%20cmake/" title="使用vscode调试c代码"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-21</div><div class="title">使用vscode调试c代码</div></div></a></div><div><a href="/2023/06/21/containers/What%20happens%20behind%20the%20scenes%20of%20a%20rootless%20Podman%20container/" title="podman创建rootless容器发生了什么"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-21</div><div class="title">podman创建rootless容器发生了什么</div></div></a></div><div><a href="/2023/06/21/containers/gvisor/" title="gVisor容器引擎"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-06-21</div><div class="title">gVisor容器引擎</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%88%9D%E8%AF%86-IPv6"><span class="toc-number">1.</span> <span class="toc-text">4、初识 IPv6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81IPv6-%E7%9A%84%E5%9C%B0%E5%9D%80%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">5、IPv6 的地址语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81IPv6-%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8F%B7%E6%AE%B5%E5%88%92%E5%88%86%E5%92%8C%E5%89%8D%E7%BC%80%E8%A1%A8%E7%A4%BA%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">6、IPv6 地址的号段划分和前缀表示法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81IPv6-%E7%9A%84%E5%9C%B0%E5%9D%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">7、IPv6 的地址类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81IPv6-%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="toc-number">5.</span> <span class="toc-text">8、IPv6 单播地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%85%A8%E7%90%83%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="toc-number">6.</span> <span class="toc-text">8.1 全球单播地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E9%93%BE%E8%B7%AF%E6%9C%AC%E5%9C%B0%E5%9C%B0%E5%9D%80"><span class="toc-number">7.</span> <span class="toc-text">8.2 链路本地地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%94%AF%E4%B8%80%E6%9C%AC%E5%9C%B0%E5%9C%B0%E5%9D%80"><span class="toc-number">8.</span> <span class="toc-text">8.3 唯一本地地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E7%AB%99%E7%82%B9%E6%9C%AC%E5%9C%B0%E5%9C%B0%E5%9D%80"><span class="toc-number">9.</span> <span class="toc-text">8.4 站点本地地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E7%89%B9%E6%AE%8A%E5%9C%B0%E5%9D%80%EF%BC%9A%E5%9B%9E%E7%8E%AF%E5%9C%B0%E5%9D%80"><span class="toc-number">10.</span> <span class="toc-text">8.5 特殊地址：回环地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-%E8%BF%87%E6%B8%A1%E5%9C%B0%E5%9D%80%EF%BC%9A%E5%86%85%E5%B5%8C-IPv4-%E5%9C%B0%E5%9D%80%E7%9A%84-IPv6-%E5%9C%B0%E5%9D%80"><span class="toc-number">11.</span> <span class="toc-text">8.6 过渡地址：内嵌 IPv4 地址的 IPv6 地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81IPv4-%E5%85%BC%E5%AE%B9%E5%9C%B0%E5%9D%80"><span class="toc-number">12.</span> <span class="toc-text">9、IPv4 兼容地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81IPv6-%E6%8E%A5%E5%8F%A3-ID-%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95"><span class="toc-number">13.</span> <span class="toc-text">10、IPv6 接口 ID 生成算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81IPv6-%E5%9C%B0%E5%9D%80%E9%85%8D%E7%BD%AE"><span class="toc-number">14.</span> <span class="toc-text">11、IPv6 地址配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81IPv6-%E7%9A%84%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">15.</span> <span class="toc-text">12、IPv6 的域名解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E6%9B%B4%E5%A4%9A%E7%9B%B8%E5%85%B3%E6%96%87%E7%AB%A0"><span class="toc-number">16.</span> <span class="toc-text">附录：更多相关文章</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/08/sdn/IEEE%20802.1Q%20%E5%B0%81%E8%A3%85%E7%9A%84%20VLAN%20%E6%95%B0%E6%8D%AE%E5%B8%A7%E6%A0%BC%E5%BC%8F%20/" title="无题">无题</a><time datetime="2023-12-08T09:57:19.865Z" title="发表于 2023-12-08 17:57:19">2023-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/08/sdn/Linux%20%E4%B8%8B%20Pcap%20%E5%8C%85%E9%87%8D%E6%94%BE%E5%B7%A5%E5%85%B7%20Tcpreplay%20%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" title="无题">无题</a><time datetime="2023-12-08T09:57:19.865Z" title="发表于 2023-12-08 17:57:19">2023-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/08/sdn/OpenFlow%20%E6%B5%81%E8%A1%A8%E6%A6%82%E8%BF%B0/" title="无题">无题</a><time datetime="2023-12-08T09:57:19.865Z" title="发表于 2023-12-08 17:57:19">2023-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/08/sdn/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E6%A0%BC%E5%BC%8F%E3%80%81IP%20%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F%E3%80%81TCPUDP%20%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F/" title="无题">无题</a><time datetime="2023-12-08T09:57:19.865Z" title="发表于 2023-12-08 17:57:19">2023-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/02/sdn/netperf%20%E7%9A%84%E4%BD%BF%E7%94%A8/" title="无题">无题</a><time datetime="2023-12-02T05:58:53.067Z" title="发表于 2023-12-02 13:58:53">2023-12-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="哪吒藕霸" target="_blank">哪吒藕霸</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/algorithm/" style="font-size: 0.88rem;">algorithm<sup>1</sup></a><a href="/tags/blockchain/" style="font-size: 0.88rem;">blockchain<sup>1</sup></a><a href="/tags/c/" style="font-size: 0.88rem;">c<sup>1</sup></a><a href="/tags/container/" style="font-size: 0.88rem;">container<sup>27</sup></a><a href="/tags/go/" style="font-size: 0.88rem;">go<sup>11</sup></a><a href="/tags/kidgets/" style="font-size: 0.88rem;">kidgets<sup>3</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>22</sup></a><a href="/tags/rust/" style="font-size: 0.88rem;">rust<sup>6</sup></a><a href="/tags/sdn/" style="font-size: 0.88rem;">sdn<sup>1</sup></a><a href="/tags/tools/" style="font-size: 0.88rem;">tools<sup>1</sup></a><a href="/tags/tvbox/" style="font-size: 0.88rem;">tvbox<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 哪吒藕霸 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>